<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>语法糖的博客</title>
  
  <subtitle>爱动漫，热爱LOL</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-04-17T01:22:55.117Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>chenye2017</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>apache简单配置</title>
    <link href="http://yoursite.com/2018/04/16/apache%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE/"/>
    <id>http://yoursite.com/2018/04/16/apache简单配置/</id>
    <published>2018-04-16T13:38:54.000Z</published>
    <updated>2018-04-17T01:22:55.117Z</updated>
    
    <content type="html"><![CDATA[<p>关于apache的配置文件。不管是xampp安装的lamp环境，还是自己在linux下面搭建的lamp环境，之前关于apache的配置都是直接copy网上的，用的虚拟域名，本质是还是不够理解的，关于.htaccess 也只是刚开始学习tp的时候看到过，后来因为配置虚拟域名能解决问题，就没有过多的了解这个.htaccess了。</p><a id="more"></a><p>首先说一下之前遇到的问题。某次，帮助交付的一个同事配置xampp环境，他当时对多站点的配置文件都写在了apache的主配置文件中，httpd.conf,当时因为已经了解了虚拟域名，所以我在同级目录extra下面的httpd-vhost.conf中帮他写了新的配置，当时用的是不同域名分发到不同文件夹下的方式，其实这在实际生活中也是这样的，因为如果靠的是端口号的话，因为web服务默认是80端口，如果用了别的端口号，比如http:\\www.baidu.com:800, 这样访问百度的web服务，这对广大用户是不友好的，因为对于非程序员来说，根本不知道:800是什么。如果不想用域名开进行分发，端口号也是可以的，但为了不让用户去记忆端口号，可以通过nginx来帮忙。比如itbasic.datatom.com和bbs.datatom.com虽然绑定的是同一个服务器，但是通过nginx的转发，到了不同的端口，一个因为是从itbasic.datatom.com+ 80端口来的，所以转发到本服务器的8080端口，一个是从bbs.datatom.com+80端口来的，所以到了8081端口。我就是通过上述两种方式之一的域名不同来帮那个同事写的vhost配置的，可是呢，当我输入域名的时候，他虽然能访问，但是访问的还是之前他的一个网站，fuck！！！算了，配置文件写的这么乱，我就没找原因了，直接帮他copy了以前主配置文件里面写的一个站点配置。</p><p>其实后来我差不多知道原因了，大概是直接在主配置文件里面写了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">ServerName localhost:80</div><div class="line">DocumentRoot &quot;F:/www&quot;</div><div class="line">&lt;Directory &quot;F:/www&quot;&gt;</div><div class="line">    #</div><div class="line">    # Possible values for the Options directive are &quot;None&quot;, &quot;All&quot;,</div><div class="line">    # or any combination of:</div><div class="line">    #   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews</div><div class="line">    #</div><div class="line">    # Note that &quot;MultiViews&quot; must be named *explicitly* --- &quot;Options All&quot;</div><div class="line">    # doesn&apos;t give it to you.</div><div class="line">    #</div><div class="line">    # The Options directive is both complicated and important.  Please see</div><div class="line">    # http://httpd.apache.org/docs/2.4/mod/core.html#options</div><div class="line">    # for more information.</div><div class="line">    #</div><div class="line">    Options Indexes FollowSymLinks Includes ExecCGI</div><div class="line"></div><div class="line">    #</div><div class="line">    # AllowOverride controls what directives may be placed in .htaccess files.</div><div class="line">    # It can be &quot;All&quot;, &quot;None&quot;, or any combination of the keywords:</div><div class="line">    #   AllowOverride FileInfo AuthConfig Limit</div><div class="line">    #</div><div class="line">    AllowOverride All</div><div class="line"></div><div class="line">    #</div><div class="line">    # Controls who can get stuff from this server.</div><div class="line">    #</div><div class="line">    Require all granted</div><div class="line">&lt;/Directory&gt;</div></pre></td></tr></table></figure><p>问题的关键就是那个server name，因为是localhost：80，但凡是host（windows下）里面127.0.0.1 用的80端口，统一转发到这个目录下，造成了上述结果。其实itbasic的服务器配置上也是这么写的，但之外的那些bbs，51dana用的却是虚拟域名，为啥那个能正常访问呢，在于配置文件上面定义了server name itbasic.datatom.com。其实itbasic那个也是可以通过域名来进行分发的，主要在每个vhost里面加个server name 就可以了。itbasic那个完全也可以不用端口进行转发，完全可以通过域名，在每个vhost里面加上server name就可以了</p><p>先说一下关于vhost的配置方法吧</p><p>打开apache的配置文件 htppd.cnf。分别打开重写扩展和虚拟主机扩展：</p><blockquote><p>LoadModule rewrite_module modules/mod_rewrite.so 这句前面的 注释 # 去掉</p><p>Include conf/extra/httpd-vhosts.conf 这句前面的 注释 # 去掉</p></blockquote><p>但现在一般apache都是默认开启的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;VirtualHost *:80&gt;   //包裹的内容代表虚拟主机，端口号80</div><div class="line">    DocumentRoot &quot;D:/wamp/www/testphp/&quot;  //项目的根目录</div><div class="line">    ServerName php.iyangyi.com   //域名</div><div class="line">    ServerAlias www.pptv.cn #可省略  //这个是我们的虚拟域名的别名，可以不要，他的出现场景就是我们希望另外一个域名也往这个目录下调整。比如 www.pptv.cn 我们也希望跳到这里来，就可以这样做，但是前提是 www.pptv.cn 也要绑定host 127.0.0.1</div><div class="line">    ServerAdmin stefan321@qq.com #可省略  //这里填 服务器管理员的邮箱，也可以不要，当服务器出现故障后，如果提前有配置邮箱的话，会往这个邮箱发邮件，或者是显示在网页的错误信息当中。一般我们可以不填。</div><div class="line">    ErrorLog logs/dev-error.log #可省略  //当访问出现错误的时候，就会记录到这里，注意：logs/dev-error.log 这个文件路径是apache的安装目录下的logs 目录 。可以不要。</div><div class="line">    CustomLog logs/dev-access.log common #可省略 //这里填 访问日志，用来记录每一次的请求访问，可以不要。注意：logs/dev-access.log 这个文件路径是apache的安装目录下的logs 目录 。记住：路径后面加common。</div><div class="line">    ErrorDocument 404 logs/404.html #可省略 //这里填 403,404等错误信息调整页面，用来访问出现404页面等情况时的错误页面展示，比较有用，也可以不要。注意：/404.html 这个文件路径是项目的根目录，不是apache的目录。</div><div class="line">    &lt;Directory &quot;D:/wamp/www/testphp/&quot;&gt;</div><div class="line">        Options Indexes FollowSymLinks</div><div class="line">        AllowOverride All</div><div class="line">        Order Allow,Deny</div><div class="line">        Allow from all</div><div class="line">        RewriteEngine on</div><div class="line">        RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</div><div class="line">        RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</div><div class="line">        RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]</div><div class="line">    &lt;/Directory&gt;</div><div class="line">&lt;/VirtualHost&gt;</div></pre></td></tr></table></figure><p>一般配置的时候，上面写了可省略的都不会配置。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Directory &quot;D:/wamp/www/testphp/&quot;&gt;</div></pre></td></tr></table></figure><p>是最重要的一步了，这里也是填本项目的路径，然后所有的<code>rewrite</code>规则都是在里面完成。所以这个是很重要的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Options Indexes FollowSymLinks</div></pre></td></tr></table></figure><p>作用我访问php.iyangyi.com，如果文件根目录里有 index.html(index.php)，浏览器就会显示 index.html的内容，如果没有 index.html，浏览器就会显示这文件根目录的目录列表，目录列表包括文件根目录下的文件和子目录。</p><p>到底是优先显示index.php还是index.html 有apache的配置决定的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;IfModule dir_module&gt;</div><div class="line">    DirectoryIndex index.html index.htm index.php index.php3  </div><div class="line">&lt;/IfModule&gt;</div></pre></td></tr></table></figure><p>这个是单独写出来的，而不是写在上述标签之内。这个感觉应该是统一定义一个就行了，或者是在vhost里面直接写directoryindx 这个标签，如果没写默认是index.html或者是index.php</p><p>之前遇到一个问题就是public文件夹因为是统一对外开放的嘛，不做处理的话，比如itbasic.datatom.com/userpic,可以访问服务器上public下面这个userpic文件夹，为了不让用户访问，我们可以去掉</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Options Indexes FollowSymLinks</div></pre></td></tr></table></figure><p>的indexes,用户就不能访问了。</p><p><code>Order Deny,Allow Allow from all</code>这2个一般是组合在一起用。用来<code>设置访问权限</code> ，设置哪些ip可以访问这个域名, 哪些ip禁止访问。</p><p>所以order是设置这2个的组合排序, 不区分大小写，中间用<code>,</code>分开，中间不能有空格。 </p><p>所以order是设置这2个的组合排序, 不区分大小写，中间用<code>,</code>分开，中间不能有空格。<br><code>Order Deny,Allow</code> ：表示设定“先检查禁止设定，没有设定禁止的全部允许”</p><p><code>Order Allow,Deny</code> : 表示设定“先检查允许设定，没有设定允许的全部禁止”</p><p><strong>而且最后的访问结果有第二参数决定！</strong></p><p><code>Deny from All</code> <code>Deny from 127.0.0.1</code> 禁止访问的ip， all 表示全部 </p><p><code>Deny from All</code> <code>Deny from 127.0.0.1</code> 禁止访问的ip， all 表示全部<br><code>Allow from All</code> <code>Allow from 127.0.0.1</code> 允许访问的ip， all 表示全部</p><p>我们看几个他们2个组合的例子。</p><p>这个例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Order Deny,Allow</div><div class="line">Deny from All</div></pre></td></tr></table></figure><p>表示先检查允许的, 没有允许的全部禁止。但是下却没有Allow，那么就表示是无条件禁止了所有的访问了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Order Deny,Allow</div><div class="line">Deny from all</div><div class="line">Allow from 127.0.0.1</div></pre></td></tr></table></figure><p>上面表示 只允许127.0.0.1访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Order Allow,Deny</div><div class="line">Allow from all</div><div class="line">Deny from 127.0.0.1 192.168.1.51</div></pre></td></tr></table></figure><p>上面表示禁止127.0.0.1和192.168.1.51访问，其他都可以！</p><p>所以这个的组合就可以达到很多的过滤访问效果。</p><p>但现在一般不用那个了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Require all granted</div></pre></td></tr></table></figure><p>才能解决，要么一直都是403。</p><h2 id="RewriteCond-与-RewriteRule-指令格式配置详解"><a href="#RewriteCond-与-RewriteRule-指令格式配置详解" class="headerlink" title="RewriteCond 与 RewriteRule 指令格式配置详解"></a>RewriteCond 与 RewriteRule 指令格式配置详解</h2><p>上面花了大量的时间讲述<code>VirtualHost</code> 里面的一些配置参数的写法和作用，接下来就是rewrite的重点了，3个核心的东西：<strong>RewriteEngine，RewriteCond，RewriteRule</strong></p><p><strong>RewriteEngine</strong> </p><p><strong>RewriteEngine</strong><br>这个是rewrite的<code>总开关</code>，用来开启是否启动url rewrite，要想打开，像这样就可以了：</p><blockquote><p>RewriteEngine on</p></blockquote><p><strong>RewriteCond 和 RewriteRule</strong> </p><p><strong>RewriteCond 和 RewriteRule</strong><br>表示指令定义和匹配一个规则条件，让RewriteRule来重写。说的简单点，RewriteCond就像我们程序中的if语句一样，表示如果符合某个或某几个条件则执行RewriteCond下面紧邻的RewriteRule语句，这就是RewriteCond最原始、基础的功能。</p><p>先看个例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RewriteEngine on</div><div class="line">RewriteCond  %&#123;HTTP_USER_AGENT&#125;  ^Mozilla//5/.0.*</div><div class="line">RewriteRule  index.php            index.m.php</div></pre></td></tr></table></figure><p>上面的匹配规则就是：如果匹配到http请求中HTTP_USER_AGENT 是 Mozilla//5/.0.* 开头的，也就是用FireFox浏览器访问index.php这个文件的时候，会自动让你访问到index.m.php这个文件。</p><p><strong>RewriteCond 和 RewriteRule 是上下对应的关系。可以有1个或者好几个RewriteCond来匹配一个RewriteRule</strong></p><p>RewriteCond一般是这样使用的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RewriteCond %&#123;XXXXXXX&#125; + 正则匹配条件</div></pre></td></tr></table></figure><p>那么RewriteCond可以匹配什么样的数据请求呢？ </p><p>那么RewriteCond可以匹配什么样的数据请求呢？<br>它的使用方式是：<code>RewriteCond %{NAME_OF_VARIABLE} REGX</code> FLAG</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RewriteCond %&#123;HTTP_REFERER&#125; (www.test.cn)</div><div class="line">RewriteCond %&#123;HTTP_USER_AGENT&#125;  ^Mozilla//5/.0.*</div><div class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</div></pre></td></tr></table></figure><p>上面是常见的3种最常见使用最多的<code>HTTP头连接与请求</code>匹配。</p><p><strong>HTTP_REFERER</strong> </p><p><strong>HTTP_REFERER</strong><br>这个匹配访问者的地址，php中$_REQUREST中也有这个，当我们需要判断或者限制访问的来源的时候，就可以用它。</p><p>比如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">RewriteCond %&#123;HTTP_REFERER&#125; (www.test.cn)</div><div class="line">RewriteRule (.*)$ test.php</div></pre></td></tr></table></figure><p>上面语句的作用是如果你访问的上一个页面的主机地址是www.test.cn，则无论你当前访问的是哪个页面，都会跳转到对test.php的访问。</p><p>再比如，也可以利用 HTTP_REFERER <code>防倒链</code>，就是限制别人网站使用我网站的图片。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RewriteCond %&#123;HTTP_REFERER&#125; !^$ [NC]</div><div class="line">RewriteCond %&#123;HTTP_REFERER&#125; !ww.iyangyi.com [NC]</div><div class="line">RewriteRule \.(jpg|gif) http://image.baidu.com/ [R,NC,L]</div></pre></td></tr></table></figure><p>NC nocase的意思，忽略大小写。第一句呢，是必须要有域名，第一句就是看域名如果不是 www.iyangyi.com 的，当访问.jpg或者.gif文件时候，就都会自动跳转到 <a href="http://image.baidu.com/" target="_blank" rel="external">http://image.baidu.com/</a> 上，很好的达到了防盗链的要求。</p><p><strong>REQUEST_FILENAME</strong> </p><p><strong>REQUEST_FILENAME</strong><br>这个基本是用的最多的，以为url重写是用的最多的，它是匹配当前访问的域名文件，那哪一块属于REQUEST_FILENAME 呢？是url 除了host域名外的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://www.rainleaves.com/html/1569.html?replytocom=265</div></pre></td></tr></table></figure><p>这个url，那么 REQUEST_FILENAME 就是 <code>html/1569.html?replytocom=265</code></p><p>看个例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</div><div class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</div><div class="line">RewriteRule ^room/video/(\d+)\.html web/index\.php?c=room&amp;a=video&amp;r=$1 [QSA,NC,L]</div></pre></td></tr></table></figure><p><code>-d</code> 是否是一个目录. 判断TestString是否不是一个目录可以这样: <code>!-d</code> </p><p><code>-d</code> 是否是一个目录. 判断TestString是否不是一个目录可以这样: <code>!-d</code><br><code>-f</code> 是否是一个文件. 判断TestString是否不是一个文件可以这样: <code>!-f</code></p><p>这两句语句<code>RewriteCond</code>的意思是请求的文件或路径是不存在的，如果文件或路径存在将返回已经存在的文件或路径。一般是这样结合在一起用的。</p><p>上面<code>RewriteRule</code>正则的意思是以 room开头的 room/video/123.html 这样子，变成 web/index.php?c=room&amp;a=video&amp;r=123</p><p><code>$1</code> 表示匹配到的第一个参数。</p><h2 id="RewriteRule-写法和规则"><a href="#RewriteRule-写法和规则" class="headerlink" title="RewriteRule 写法和规则"></a>RewriteRule 写法和规则</h2><p>RewriteRule是配合RewriteCond一起使用，可以说，RewriteRule是RewriteCond成功匹配后的执行结果，所以，它是很重要的。</p><p>来看一下 <code>RewriteRule</code>的写法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RewriteRule Pattern Substitution [flags]</div></pre></td></tr></table></figure><p><code>Pattern</code>是一个正则匹配。<code>Substitution</code>是匹配的替换 <code>[flags]</code>是一些参数限制；</p><p>我们看几个例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RewriteRule ^room/video/(\d+)\.html web/index\.php?c=room&amp;a=video&amp;r=$1 [QSA,NC,L]</div></pre></td></tr></table></figure><p>意思是 以 room开头的 room/video/123.html 这样子，变成 web/index.php?c=room&amp;a=video&amp;r=123</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RewriteRule \.(jpg|gif) http://image.baidu.com/ [R,NC,L]</div></pre></td></tr></table></figure><p>意思是以为是访问.jpg或者gif的文件，都会调整到 <a href="http://image.baidu.com/" target="_blank" rel="external">http://image.baidu.com</a></p><p>所以，掌握正则级是关键所在了。以后，我会专门搞一个正则的篇章来学习下。</p><p>我们再看看<code>[flags]</code>是什么意思？</p><p>因为它太多了。我就挑几个最常用的来说说吧。</p><p><code>[QSA]</code> qsappend(追加查询字符串)的意思，次标记强制重写引擎在已有的替换字符串中追加一个查询字符串，而不是简单的替换。如果需要通过重写规则在请求串中增加信息，就可以使用这个标记。上面那个<code>room</code>的例子，就必须用它。</p><p><code>NC</code> nocase(忽略大小写)的意思，它使Pattern忽略大小写，也就是在Pattern与当前URL匹配时，”A-Z”和”a-z”没有区别。这个一般也会加上，因为我们的url本身就不区分大小写的。</p><p><code>R</code> redirect(强制重定向)的意思，适合匹配Patter后，Substitution是一个http地址url的情况，就调整出去了。上面那个调整到image.baidu.com的例子，就必须也用它。</p><p><code>L</code> last(结尾规则)的意思，就是已经匹配到了，就立即停止，不再匹配下面的Rule了，类似于编程语言中的<code>break</code>语法，跳出去了。</p><p>其他的一些具体的语法，可以参考以下资料：</p><p><a href="http://www.skygq.com/2011/02/21/apache%E4%B8%ADrewritecond%E8%A7%84%E5%88%99%E5%8F%82%E6%95%B0%E4%BB%8B%E7%BB%8D%E8%BD%AC/" target="_blank" rel="external">http://www.skygq.com/2011/02/21/apache%E4%B8%ADrewritecond%E8%A7%84%E5%88%99%E5%8F%82%E6%95%B0%E4%BB%8B%E7%BB%8D%E8%BD%AC/</a></p><p><a href="http://www.2cto.com/os/201201/116040.html" target="_blank" rel="external">http://www.2cto.com/os/201201/116040.html</a></p><p><a href="http://www.cnblogs.com/adforce/archive/2012/11/23/2784664.html" target="_blank" rel="external">http://www.cnblogs.com/adforce/archive/2012/11/23/2784664.html</a></p><h2 id="htaccess文件的使用"><a href="#htaccess文件的使用" class="headerlink" title=".htaccess文件的使用"></a>.htaccess文件的使用</h2><p><code>.htaccess</code>文件是啥呢？我们前面说了这么多的配置和修改，都是针对于apache的配置文件来修改的。.htaccess文件就是它的一个替代品。为啥呢？因为你每次修改apache的配置文件，都必须重启apache服务器，很麻烦不说，有些共享apache的服务器，你还没权限修改和重启apache。所以，.htaccess文件就应运而生了。（不用重启apache,是真的挺方便的）</p><p><code>.htaccess</code>分布式配置文件。它文件名字比较奇怪，没有文件名，只有一个文件后缀就是<code>.htaccess</code>。所以一般在windows下还没法新建这个文件，因为windows不允许文件名是空的，比较蛋疼。但是我相信你总归会有办法新建这个文件的。（在linux下新建一个，下载到windows中呗）</p><p><code>.htaccess</code>同时是一个针对目录的配置，你可以把它放到项目的根目录下，那么它就多整个项目其效果，如果你把它放到一个单独的子目录下，那么它就对这个子目录其效果了。</p><p><strong>.htaccess</strong>文件如何生效呢。上面讲配置的时候，我讲过了<code>AllowOverride All</code>这个配置，它就是启动<code>.htaccess</code>文件是否可以使用的。<code>AllowOverrideAll</code>表示可以。<code>AllowOverride None</code>表示禁止使用。还是蛮简单的。</p><p><strong>那.htaccess文件里的语法是怎么写额呢？</strong></p><p>其实和上面说的一模一样的写法。可以完全的搬过来用。没问题。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"> &lt;Directory &quot;D:/wamp/www/testphp/&quot;&gt;</div><div class="line">    Options Indexes FollowSymLinks</div><div class="line">    AllowOverride All</div><div class="line">    Order Allow,Deny</div><div class="line">    Allow from all</div><div class="line">    RewriteEngine on</div><div class="line">    RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</div><div class="line">    RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</div><div class="line">    RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]</div><div class="line">&lt;/Directory&gt;</div></pre></td></tr></table></figure><p>上面的apache的<code>`里的这一块就可以完全的搬到</code>.htaccess`文件中来，且效果一模一样。</p><p>上面就是vhost文件里面的配置的大致写法，其实httpd.conf里面也是这么写的，毕竟vhost最后还是包含到主配置文件里面。</p><p>documentroot 其实自己一直好奇为啥和directory参数一样其实本质上该项目文件夹下只有这个document root能访问，所以重写规则也好，针对的都是这个document root，导致了二者之间的相同。</p><p>有一点要注意的就是，如果通过开不同的端口号转发到不同的文件夹，需要早配置文件的开头写上Listen 127.0.0.1：8080 这样，开启端口号。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;关于apache的配置文件。不管是xampp安装的lamp环境，还是自己在linux下面搭建的lamp环境，之前关于apache的配置都是直接copy网上的，用的虚拟域名，本质是还是不够理解的，关于.htaccess 也只是刚开始学习tp的时候看到过，后来因为配置虚拟域名能解决问题，就没有过多的了解这个.htaccess了。&lt;/p&gt;
    
    </summary>
    
      <category term="apache" scheme="http://yoursite.com/categories/apache/"/>
    
    
      <category term="apache" scheme="http://yoursite.com/tags/apache/"/>
    
      <category term="linux" scheme="http://yoursite.com/tags/linux/"/>
    
      <category term="框架" scheme="http://yoursite.com/tags/%E6%A1%86%E6%9E%B6/"/>
    
  </entry>
  
  <entry>
    <title>Laravel ORM</title>
    <link href="http://yoursite.com/2018/03/30/Laravel-ORM/"/>
    <id>http://yoursite.com/2018/03/30/Laravel-ORM/</id>
    <published>2018-03-30T03:30:05.000Z</published>
    <updated>2018-03-30T07:57:06.921Z</updated>
    
    <content type="html"><![CDATA[<p>orm并不是一个新兴的概念，他出现很久了，只是刚开始学习的自己并没有接触到，他能帮我们少写很多代码，让我们能以更面向对象的方式来处理关于数据库的操作。</p><a id="more"></a><p>Eloquent 是laravel的orm，我们通过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php artisan make:model User</div></pre></td></tr></table></figure><p>生成的类虽然是继承Model，但本质上都是继承这个Eloquent，他把我们每张表看做一个类，表里面的数据看做一个实例，我们对其进行操作的时候，更类似于面向对象的操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$user = User::find(1);</div><div class="line">$user-&gt;name = &apos;cy&apos;;</div><div class="line">$user-&gt;city = &apos;shanghai&apos;;</div><div class="line">$user-&gt;save();</div></pre></td></tr></table></figure><p>更便于理解。</p><p>生成的model很简单，大致</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line"></div><div class="line">class Article extends \Eloquent &#123;</div><div class="line"></div><div class="line">protected $fillable = [];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>这个fillable里面就是可以批量操作的字段，批量操作在我之前的文章里面有提到过，我觉得更通俗的理解是可更新的字段。只需要继承一下 Eloquent 类，就可以干 ‘first() find() where() orderBy()’ 等非常非常多的事情，这就是面向对象的强大威力。</p><p>通过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php artisan tinker</div></pre></td></tr></table></figure><p>可以开启一个交互环境进行orm的调试，其实我感觉不止是orm，别的代码也都是可以执行的，只是方便了orm的打印操作，能很方便的看到执行结果。有一点需要注意的就是tinker是基于当前代码的，如果代码重新修改来了，我们需要重启tinker来加载新的代码。</p><p>还有我们会利用composer安装laravel-debugbar，来进行orm的调试，当我发现在别的项目中使用不了这个插件的时候，我改变了对composer的看法，他安装的东西更类似于代码，而不是软件，我们如果要在不同的项目中也使用这个插件，我们同样需要在另一个项目目录线面进行composer安装</p><p>介绍几个常用的函数</p><ul><li><p>find()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">User::find(1)</div><div class="line">App\User &#123;#764</div><div class="line">     id: 1,</div><div class="line">     name: &quot;cy&quot;,</div><div class="line">     email: &quot;1967196626@qq.com&quot;,</div><div class="line">     created_at: &quot;2018-03-30 01:42:40&quot;,</div><div class="line">     updated_at: &quot;2018-03-30 01:59:51&quot;,</div><div class="line">   &#125;</div></pre></td></tr></table></figure><p>这个1是主键</p></li></ul><ul><li><p>first()</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">User::where(&apos;id&apos;, &apos;&gt;&apos;, 1)-&gt;first()</div><div class="line">App\User &#123;#771</div><div class="line">     id: 2,</div><div class="line">     name: &quot;Bella Lebsack&quot;,</div><div class="line">     email: &quot;cristobal58@example.net&quot;,</div><div class="line">     created_at: &quot;2018-03-30 01:59:51&quot;,</div><div class="line">     updated_at: &quot;2018-03-30 01:59:51&quot;,</div><div class="line">   &#125;</div></pre></td></tr></table></figure><p>上面两个获取的内容都是对象，可以直接使用</p></li><li><p>get()  获取的是一个collection</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> User::where(&apos;id&apos;, &apos;&gt;&apos;, 1)-&gt;where(&apos;id&apos;, &apos;&lt;&apos;, 3)-&gt;get()</div><div class="line">=&gt; Illuminate\Database\Eloquent\Collection &#123;#773</div><div class="line">     all: [</div><div class="line">       App\User &#123;#778</div><div class="line">         id: 2,</div><div class="line">         name: &quot;Bella Lebsack&quot;,</div><div class="line">         email: &quot;cristobal58@example.net&quot;,</div><div class="line">         created_at: &quot;2018-03-30 01:59:51&quot;,</div><div class="line">         updated_at: &quot;2018-03-30 01:59:51&quot;,</div><div class="line">       &#125;,</div><div class="line">     ],</div><div class="line">   &#125;</div></pre></td></tr></table></figure></li><li><p>all() 获取的是一个collection</p></li></ul><p>​    all的使用好像不能加条件</p><p>​    上面的collection可以通过toArray() 方法转换成数组，但其实我们平时用的时候没用toArray也是可以的</p><p>上面需要注意的点就是：</p><ol><li>所有的中间方法如 ‘where()’ ‘orderBy()’ 等都能够同时支持 ‘静态’ 和 ‘非静态链式’ 两种方式调用，即 ‘Article::where()…’ 和 ‘Article::….-&gt;where()’。</li><li>所有的 ‘非固定用法’ 的调用最后都需要一个操作来 ‘收尾’，本片教程中有两个 ‘收尾操作’：’-&gt;get()’ 和 ‘-&gt;first()’。</li><li>每一个继承了 Eloquent 的类都有两个 ‘固定用法’ ‘Article::find($number)’ ‘Article::all()’，前者会得到一个带有数据库中取出来值的对象，后者会得到一个包含整个数据库的对象合集。</li></ol><p>Builder</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Article::where(&apos;id&apos;, &apos;&gt;&apos;, 10)-&gt;where(&apos;id&apos;, &apos;&lt;&apos;, 20)-&gt;orderBy(&apos;updated_at&apos;, &apos;desc&apos;)-&gt;get();</div></pre></td></tr></table></figure><p>这段代码的 <code>::where()-&gt;where()-&gt;orderBy()</code> 就是Builder。用面向对象的方法来理解，可以总结成一句话：创建一个对象，并不断修改它的属性，最后用一个操作来触发数据库操作。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">User::orderBy(&apos;id&apos;, &apos;desc&apos;);</div><div class="line">=&gt; Illuminate\Database\Eloquent\Builder &#123;#817&#125;</div></pre></td></tr></table></figure><p>这个get() 就是那个最后的方法。</p><p>值的思考的一个问题</p><blockquote><p>如果直接用 :: 来访问某个 function，无论这个 function 是否为 static，构造函数 __construct() 都不会被调用，那么创建对象是如何实现的呢？请看：<a href="https://github.com/illuminate/database/blob/master/Eloquent/Model.php#L3354" target="_blank" rel="external">https://github.com/illuminate/database/blob/master/Eloquent/Model.php#L3354</a></p></blockquote><p>所谓 “终结者” 方法，指的是在 N 个中间操作流方法对某个 Eloquent 对象进行加工以后，触发最终的数据库查询操作，得到返回值。</p><p><code>first()</code> <code>get()</code> <code>paginate()</code> <code>count()</code> <code>delete()</code> 是用的比较多的一些 “终结者” 方法，他们会在中间操作流的最后出现，把 SQL 打给数据库，得到返回数据，经过加工返回一个 Article 对象或者一群 Article 对象的集合。</p><p>all() 方法好像不是，因为all() 好像不能跟着条件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"> User::orderBy(&apos;id&apos;, &apos;desc&apos;)-&gt;all();</div><div class="line">BadMethodCallException with message &apos;Call to undefined method Illuminate\Database\Query\Builder::all()</div></pre></td></tr></table></figure><p>关系</p><p>1 对 1 关系</p><p>做了个试验，发现如果通过传统的生成迁移文件，生成model，进行数据填充真的挺麻烦的，不如在数据库中快速建表来的容易</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">public function hasOne1()</div><div class="line">    &#123;</div><div class="line">        return $this-&gt;hasOne(TestOneToOne::class, &apos;user_id&apos;, &apos;id&apos;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public function belongsTo1()</div><div class="line">    &#123;</div><div class="line">        return $this-&gt;belongsTo(TestOneToOne::class, &apos;id&apos;, &apos;user_id&apos;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p>这是User 中的两个方法</p><p>User::with(‘hasOne1’)-&gt;find(1)</p><p>User::with(‘belongsTo1’)-&gt;find(1)</p><p>获取的数据是一样的，说一下我的记忆方法。hasOne 的时候，对方表中的字段在前面，belongsTo的时候自己表中的数据在前面。（我一般喜欢用with表示模型的结合）</p><p>还有第一个参数注意一下，话说这个::class出现好久了，而我却很少用，真的很方便哦。</p><p>还有默认的orm模型名称都是表名的单数，这个是一定要注意的哦。除非自己重新定义。（many 都能识别成功manies,牛逼）</p><p>1对多</p><p>这个时候的belongsTo 只有一种了，和上面的一样，hasMany() 和上面也类似。值的注意的一点就是那个表::with就成主体了，还有一点的就是使用with的时候并不是和我们传统的那种使用left join，而是先计算出主表，再根据主表中的数据，就算从表中对应数据in() 这个集合中，我不能理解的一点就是这样通过in，怎么完成了数据的连接。</p><p>多对多</p><p>这个时候经常需要第三张表来存储数据，值的注意的一点就是第三张表往往不需要生成model。</p><p>第三张表值记录对应关系，感觉默认的就是主键id</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public function belongsToMany1()</div><div class="line">    &#123;</div><div class="line">        return $this-&gt;belongsToMany(\App\User::class, &apos;test_many_to_many&apos;, &apos;user_id&apos;, &apos;test_id&apos;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p>上面是一种我的粉丝，比如我是users 表中的一员，我的粉丝也是这张表中的数据，注意存储数据关系的表不要用::class，因为不存在这个class，还有如果要加where条件，里面的条件用调用主题的字段，比如users中的字段id。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;orm并不是一个新兴的概念，他出现很久了，只是刚开始学习的自己并没有接触到，他能帮我们少写很多代码，让我们能以更面向对象的方式来处理关于数据库的操作。&lt;/p&gt;
    
    </summary>
    
      <category term="Laravel" scheme="http://yoursite.com/categories/Laravel/"/>
    
    
      <category term="Laravel" scheme="http://yoursite.com/tags/Laravel/"/>
    
      <category term="orm" scheme="http://yoursite.com/tags/orm/"/>
    
  </entry>
  
  <entry>
    <title>Laravel 数据填充</title>
    <link href="http://yoursite.com/2018/03/30/Laravel-%E6%95%B0%E6%8D%AE%E5%A1%AB%E5%85%85/"/>
    <id>http://yoursite.com/2018/03/30/Laravel-数据填充/</id>
    <published>2018-03-30T02:01:03.000Z</published>
    <updated>2018-03-30T06:41:23.787Z</updated>
    
    <content type="html"><![CDATA[<p>作为一个phper，Laravel的学习是必不可少的，可是这个框架的学习成本还是挺大的，有些东西现在可能不明白，但至少记录下来，慢慢的成长。</p><a id="more"></a><p>在laravel的学习中，感觉挺好用的相比较于我们现在，数据填充是一个很不错的功能，能生成一大堆假的数据把页面填充起来，让他更有实际的样子。</p><p>数据填充，和数据库相关，自然去database下面。seeds目录，databaseseeder,这个文件主要是让我们在运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php artisan db:seed</div></pre></td></tr></table></figure><p>的时候，执行哪些数据填充的文件，其参数可以让我们执行哪些填充文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public function run()</div><div class="line">    &#123;</div><div class="line">        // $this-&gt;call(UsersTableSeeder::class);</div><div class="line">        Model::unguard();</div><div class="line">        $this-&gt;call(UsersTableSeeder::class);</div><div class="line">        Model::reguard();</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p>上面就是基础的database seeder 里面的内容，前面两个主要是接触限制（官方叫批量赋值，就是默认model里面只有fileable的字段可以填充，为什么要规定这个呢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public function create(Request $req)</div><div class="line">&#123;</div><div class="line">$this-validate($req, [</div><div class="line">  &apos;name&apos; =&gt; &apos;required|min:5&apos;,</div><div class="line">  &apos;password&apos; =&gt; &apos;required|confirmed&apos;</div><div class="line">  ···</div><div class="line">])</div><div class="line">$name = $req-&gt;name;</div><div class="line">$password = $req-&gt;password;</div><div class="line">User::create(compact(&apos;name&apos;, &apos;password&apos;));</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>这样填充数据太麻烦了，比如我之前在itbasic上面填充数据，一个合同二十多个字段，这样往方法里面插入，一般这样</p><pre><code>public function create(Request $req){  $this-validate($req, [  &apos;name&apos; =&gt; &apos;required|min:5&apos;,          &apos;password&apos; =&gt; &apos;required|confirmed&apos;          ···  ])  User::create($req-&gt;all());}</code></pre><p>req的all方法获取的是一个关联数组，可是这样插入会导致一个问题，比如现在的表的字段的越来越规范了，比如admin字段 is_admin,这样当用户传入is_admin  1， 就完了，所以设置批量赋值，用来规定哪些字段可以传入，哪些字段不可以传入，filable 代表可以传入的，guard 代表这些不能传入。</p><p>当我们进行数据填充的时候，可能不需要字段限制，所以才会有了开始的解除限制和后面的开启限制。</p><p>接下来就是种子文件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php artisan make:seeder UsersTableSeeder</div></pre></td></tr></table></figure><p>也是只有一个run方法，这个UsersTableSeeder,只是命名规范，其实并不用，因为我们在写run方法的时候，就是在写普通的插入语句</p><pre><code>public function run(){  DB::table(&apos;articles&apos;)-&gt;delete();  for ($i=0; $i &lt; 10; $i++) {      \App\Article::create([          &apos;title&apos;   =&gt; &apos;Title &apos;.$i,          &apos;body&apos;    =&gt; &apos;Body &apos;.$i,          &apos;user_id&apos; =&gt; 1,      ]);  }}</code></pre><p>这种方法就太没有意义了，因为我们可以通过写一个接口，来进行插入，我们希望的是更真实的数据，laravel中一般使用的用工厂模式生成批量化的对象，然后进行数据填充。</p><p>查看database 下面的factory文件夹，</p><pre><code>factory-&gt;define(App\User::class, function(Faker faker) {  static $password;  return [      &apos;name&apos; =&gt; $faker-&gt;name,      &apos;email&apos; =&gt; $faker-&gt;unique()-&gt;safeEmail,      &apos;password&apos; =&gt; $password ?: $password = bcrypt(&apos;secret&apos;),      &apos;remember_token&apos; =&gt; str_random(10),  ];});</code></pre><p>这里面只是定一个一个model对象，然后在seeder里面批量化的生成这个对象<br>    public function run()<br>    {<br>        //<br>        factory(App\User::class)-&gt;times(50)-&gt;create();<br>        $user = App\User::find(1);<br>        $user-&gt;name = ‘cy’;<br>        $user-&gt;email = ‘1967196626@qq.com’;<br>        $user-&gt;password = bcrypt(‘123456’);<br>        $user-&gt;save();<br>    }<br>综上：</p><ol><li>通过factory ，定义批量化的实例对象。</li><li>通过seeder 去实例化生成对象，然后插入数据库中。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;作为一个phper，Laravel的学习是必不可少的，可是这个框架的学习成本还是挺大的，有些东西现在可能不明白，但至少记录下来，慢慢的成长。&lt;/p&gt;
    
    </summary>
    
      <category term="Laravel" scheme="http://yoursite.com/categories/Laravel/"/>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="Laravel" scheme="http://yoursite.com/tags/Laravel/"/>
    
  </entry>
  
  <entry>
    <title>PHP闭包</title>
    <link href="http://yoursite.com/2018/03/26/PHP%E9%97%AD%E5%8C%85/"/>
    <id>http://yoursite.com/2018/03/26/PHP闭包/</id>
    <published>2018-03-26T14:10:03.000Z</published>
    <updated>2018-03-26T14:11:30.145Z</updated>
    
    <content type="html"><![CDATA[<p>咱是写PHP的，可是PHP的很多特性咱都不是很熟，比如trait，闭包，咱不能只局限于表单的操作，不能只局限于面向过程的写法，记录下来那些年很少接触的特性。就从PHP的 <strong>闭包</strong> 开始咯<br><a id="more"></a></p><p>第一次接触闭包还是在js中，后来是在python中，最后才是php中！！!深刻的怀疑我是不是做php的。<br>php中闭包和js中还是不一样的，php中把匿名函数和闭包混为一谈，这让开始只知道js闭包的我好蛋疼，因为比如array_map 中经常写的回调（注意回调只是一种动作，匿名函数闭包或者是自定义函数只是实现回调的不同方法），还有最近很火的swoole，因为是异步的嘛，所以写了大量的回调函数，所以也属于闭包 ，虽然js和php的闭包有些不同但本质上还是封装函数的运行环境。<br>js:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">function out() &#123;</div><div class="line">        var a = 1;</div><div class="line">        var b = function(name) &#123;</div><div class="line">            console.log(a);</div><div class="line">            console.log(name)</div><div class="line">        &#125;</div><div class="line">        return b;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    var a = 2;</div><div class="line">    var name = &apos;cy&apos;;</div><div class="line">    var c= out();</div><div class="line">    c(name);</div></pre></td></tr></table></figure></p><p>上面这段代码虽然简单，但是包含了几个重要的知识点：</p><ol><li>js的闭包主要是靠两层函数的嵌套，然后通过调用外层的函数返回内层的函数，内层的函数可以调用外层函数中的变量，内层函数的执行可以通过后来调用的时候传入参数。</li></ol><p>php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">class Foo</div><div class="line">&#123;</div><div class="line">    public function __call($method, $args)</div><div class="line">    &#123;</div><div class="line">        if(is_callable([$this, $method])) &#123;</div><div class="line">            return call_user_func_array($this-&gt;$method, $args);</div><div class="line">        &#125;</div><div class="line">        // else throw exception</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">$obj = new Foo(&apos;Sam&apos;);</div><div class="line">$obj-&gt;say = function () &#123;</div><div class="line">    return &apos;Hello World&apos;;</div><div class="line">&#125;;</div><div class="line">echo($obj-&gt;say());</div></pre></td></tr></table></figure></p><p>当执行的say() 方法不存在的时候会自动执行<strong>call方法，然后method 传入是say方法，这里面args 因为是空，所以自动传入为空。<br>is_callable 方法判断这个$obj 实例中是否有这个方法，因为后面有定义$obj-&gt;say ,所以会自动调用。<br>call_user_func_array 会把前面这个$this-&gt;method 执行，后面args是传入的参数，相比较js就多了</strong>call() 部分。<br>上面还有一点没体现出来就是，闭包可以引用的变量是自己定义时候的父亲变量，js中可以直接在函数中使用，但是php中要用use关键字引入。</p><p>后来的php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class Foo</div><div class="line">&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">$obj = new Foo(&apos;Sam&apos;);</div><div class="line">$obj-&gt;say = function () &#123;</div><div class="line">    return &apos;Hello World&apos;;</div><div class="line">&#125;;</div><div class="line">echo($obj-&gt;say-&gt;__invoke());</div></pre></td></tr></table></figure></p><p>因为php的闭包都是一个closure类，而invoke 是这个类除了（construct 不能实例化，bind bindto 绑定方法之外的一个方法）。<br>但是这个类中不能使用this关键字，主要是这个this指代的是closure自身，因为js中this关键字老变，虽然这都被别人诟病，但相比较于php，他还需要手动绑定呢。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">class Foo</div><div class="line">&#123;</div><div class="line">    private $name;</div><div class="line"></div><div class="line">    function __construct($name)</div><div class="line">    &#123;</div><div class="line">        $this-&gt;name = $name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">$obj = new Foo(&apos;Sam&apos;);</div><div class="line"></div><div class="line">$cl = function() &#123;</div><div class="line">    return &quot;Hello &quot; . $this-&gt;name;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">$cl = $cl-&gt;bindTo($obj, $obj);</div><div class="line">echo($cl());</div></pre></td></tr></table></figure></p><blockquote><p>我們不再執著該closure一定要動態成為 $obj的method，但要存取$obj property的目標不變，程式也不變，一樣使用$this。<br>假如我們能將$obj以手動注入的方式，讓closure內部的$this改指向$obj，我們就能達到如JavaScript的效果了。<br>$cl = $cl-&gt;bindTo($obj, $obj);<br>bindTo()如同__invoke()一樣，是closure物件內建的method，它的目的就是讓我們能手動注入一個物件，讓closure物件的$this指向手動注入的物件$obj。<br>因為在closure中我們有$this-&gt;name，經過bindTo()去手動注入 $obj後，$this已經改指向$obj，所以$this-&gt;name就相當於$obj-&gt;name。<br>根據bindTo()文件 :<br>若要讓closure物件只能存取其他物件的public變數，只傳第1個參數即可。<br>若要讓closure物件存取其他物件的private或protected變數，就要傳第2個參數。<br>bindTo()對於第2個參數的要求不嚴，有幾種傳法 :<br>傳進欲存取物件的class名稱，是字串。<br>傳進欲存取的物件也可以，bindTo()會自動得知該物件的class名稱。<br>在此就一併傳進與第一個參數相同的$obj。<br>echo($cl());<br>因為$obj已經透過bindTo() 手動注入進$cl()，此時$this已經指向$obj，所以執行$cl()就可順利存$obj的property</p></blockquote><p>Modern PHP<br>中对php闭包的重要方法bindTo的解释(注意闭包closure的bindTo方法本身是三个参数的，但因为第一个参数是闭包自身，所以经常$this-&gt;bindTo(arg1,arg2)这样去掉用）。</p><p>接下来我们来看看bindTo方法，通过该方法，我们可以把闭包的内部状态绑定到其他对象上。这里bindTo方法的第二个参数显得尤为重要，其作用是指定绑定闭包的那个对象所属的PHP类，这样，闭包就可以在其他地方访问绑定闭包的对象中受保护和私有的成员变量。<br>你会发现，PHP框架经常使用bindTo方法把路由URL映射到匿名回调函数上，框架会把匿名回调函数绑定到应用对象上，这样在匿名函数中就可以使用$this关键字引用重要的应用对象：<br>class App {<br>    protected $routes = [];<br>    protected $responseStatus = ‘200 OK’;<br>    protected $responseContentType = ‘text/html’;<br>    protected $responseBody = ‘Hello World’;</p><pre><code>public function addRoute($path, $callback) {    $this-&gt;routes[$path] = $callback-&gt;bindTo($this, __CLASS__);}public function dispatch($path) {    foreach ($this-&gt;routes as $routePath =&gt; $callback) {        if( $routePath === $path) {            $callback();        }    }    header(&apos;HTTP/1.1 &apos; . $this-&gt;responseStatus);    header(&apos;Content-Type: &apos; . $this-&gt;responseContentType);    header(&apos;Content-Length: &apos; . mb_strlen($this-&gt;responseBody));    echo $this-&gt;responseBody;}</code></pre><p>}<br>这里我们需要重点关注addRoute方法，这个方法的参数分别是一个路由路径和一个路由回调，dispatch方法的参数是当前HTTP请求的路径，它会调用匹配的路由回调。第9行是重点所在，我们将路由回调绑定到了当前的App实例上。这么做能够在回调函数中处理App实例的状态：<br>$app = new App();<br>$app-&gt;addRoute(‘/user’, function(){<br>    $this-&gt;responseContentType = ‘application/json;charset=utf8’;<br>    $this-&gt;responseBody = ‘世界你好’;<br>});<br>$app-&gt;dispatch(‘/user’)</p><p>总结一下，闭包的bindTo方法的根本原因是闭包中$this关键字指向了自己，而不是指向某一个对象。</p><p>Laravel<br>中对闭包的使用<br>IoC 容器<br>匿名函数可以从父作用域继承变量，而这个父作用域是定义该闭包的函数（不一定是调用它的函数）。<br>利用这个特性，我们可以实现一个简单的控制反转IoC容器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">class Container</div><div class="line">&#123;</div><div class="line">    protected static $bindings;</div><div class="line"> </div><div class="line">    public static function bind($abstract, Closure $concrete)</div><div class="line">    &#123;</div><div class="line">        static::$bindings[$abstract] = $concrete;</div><div class="line">    &#125;</div><div class="line"> </div><div class="line">    public static function make($abstract)</div><div class="line">    &#123;</div><div class="line">        return call_user_func(static::$bindings[$abstract]);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">class talk</div><div class="line">&#123;</div><div class="line">    public function greet($target)</div><div class="line">    &#123;</div><div class="line">        echo &apos;Hello &apos; . $target-&gt;getName();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class A</div><div class="line">&#123;</div><div class="line">    public function getName()</div><div class="line">    &#123;</div><div class="line">        return &apos;World&apos;;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">// 创建一个talk类的实例</div><div class="line">$talk = new talk();</div><div class="line"> </div><div class="line">// 将A类绑定至容器，命名为foo</div><div class="line">Container::bind(&apos;foo&apos;, function() &#123;</div><div class="line">    return new A;</div><div class="line">&#125;);</div><div class="line"> </div><div class="line">// 通过容器取出实例</div><div class="line">$talk-&gt;greet(Container::make(&apos;foo&apos;)); // Hello World</div></pre></td></tr></table></figure></p><p>上述例子中，只有在通过make方法获取实例的时候，实例才被创建，这样使得我们可以实现容器。<br>在Laravel框架底层也大量使用了闭包以及bindTo方法，利用好闭包可以实现更多的高级特性如事件触发等。</p><p>laravel中的控制反转还不是很熟，以后多了解下</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;咱是写PHP的，可是PHP的很多特性咱都不是很熟，比如trait，闭包，咱不能只局限于表单的操作，不能只局限于面向过程的写法，记录下来那些年很少接触的特性。就从PHP的 &lt;strong&gt;闭包&lt;/strong&gt; 开始咯&lt;br&gt;
    
    </summary>
    
      <category term="PHP" scheme="http://yoursite.com/categories/PHP/"/>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="闭包" scheme="http://yoursite.com/tags/%E9%97%AD%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>PHP魔术方法和魔术变量</title>
    <link href="http://yoursite.com/2018/03/26/PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95%E5%92%8C%E9%AD%94%E6%9C%AF%E5%8F%98%E9%87%8F/"/>
    <id>http://yoursite.com/2018/03/26/PHP魔术方法和魔术变量/</id>
    <published>2018-03-26T07:36:28.000Z</published>
    <updated>2018-03-26T10:57:55.035Z</updated>
    
    <content type="html"><![CDATA[<p>有些东西如果不是经常使用，很容易忘记，比如魔术方法和魔术常量。<br>最主要是当看一些基本原理的代码的时候经常用到，比如闭包的时候，希望自己在学习过程中能对文章中的内容进行补充，改造，而不是单纯的靠这些简单例子来记忆&gt;</p><a id="more"></a><h2 id="魔术方法-Magic-methods"><a href="#魔术方法-Magic-methods" class="headerlink" title="魔术方法(Magic methods)"></a>魔术方法(Magic methods)</h2><p>PHP中把以两个下划线<code>__</code>开头的方法称为魔术方法，这些方法在PHP中充当了举足轻重的作用。 魔术方法包括：</p><ul><li><code>__construct()</code>，类的构造函数</li><li><code>__destruct()</code>，类的析构函数</li><li><code>__call()</code>，在对象中调用一个不可访问方法时调用</li><li><code>__callStatic()</code>，用静态方式中调用一个不可访问方法时调用</li><li><code>__get()</code>，获得一个类的成员变量时调用</li><li><code>__set()</code>，设置一个类的成员变量时调用</li><li><code>__isset()</code>，当对不可访问属性调用<code>isset()</code>或<code>empty()</code>时调用</li><li><code>__unset()</code>，当对不可访问属性调用<code>unset()</code>时被调用。</li><li><code>__sleep()</code>，执行<code>serialize()</code>时，先会调用这个函数</li><li><code>__wakeup()</code>，执行<code>unserialize()</code>时，先会调用这个函数</li><li><code>__toString()</code>，类被当成字符串时的回应方法</li><li><code>__invoke()</code>，调用函数的方式调用一个对象时的回应方法</li><li><code>__set_state()</code>，调用<code>var_export()</code>导出类时，此静态方法会被调用。</li><li><code>__clone()</code>，当对象复制完成时调用</li></ul><h3 id="construct-和-destruct"><a href="#construct-和-destruct" class="headerlink" title="__construct()和__destruct()"></a><code>__construct()</code>和<code>__destruct()</code></h3><p>构造函数和析构函数应该不陌生，他们在对象创建和消亡时被调用。例如我们需要打开一个文件，在对象创建时打开，对象消亡时关闭</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?php </div><div class="line">class FileRead</div><div class="line">&#123;</div><div class="line">    protected $handle = NULL;</div><div class="line"></div><div class="line">    function __construct()&#123;</div><div class="line">        $this-&gt;handle = fopen(...);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function __destruct()&#123;</div><div class="line">        fclose($this-&gt;handle);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">?&gt;</div></pre></td></tr></table></figure><p>这两个方法在继承时可以扩展，例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?php </div><div class="line">class TmpFileRead extends FileRead</div><div class="line">&#123;</div><div class="line">    function __construct()&#123;</div><div class="line">        parent::__construct();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function __destruct()&#123;</div><div class="line">        parent::__destruct();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">?&gt;</div></pre></td></tr></table></figure><h3 id="call-和-callStatic"><a href="#call-和-callStatic" class="headerlink" title="__call()和__callStatic()"></a><code>__call()</code>和<code>__callStatic()</code></h3><p>在对象中调用一个不可访问方法时会调用这两个方法，后者为静态方法。这两个方法我们在可变方法（Variable functions）调用中可能会用到。<br>这个方法和is_callable经常配合调用，注意是callable，不是callback， 不是回调。<br>callback 回调更多的可以理解成一种使用方式，而匿名函数则是用来满足这种使用方式的一种途径，还有别的方式能满足callback,比如直接定义一个函数，传入函数的名称（字符串，如果是匿名函数的话，要把这个匿名函数对应的变量传进去，二者还是有些不同的），只是这种方式使用起来比较麻烦，比较少而已</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">class MethodTest </div><div class="line">&#123;</div><div class="line">    public function __call ($name, $arguments) &#123;</div><div class="line">        echo &quot;Calling object method &apos;$name&apos; &quot;. implode(&apos;, &apos;, $arguments). &quot;\n&quot;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static function __callStatic ($name, $arguments) &#123;</div><div class="line">        echo &quot;Calling static method &apos;$name&apos; &quot;. implode(&apos;, &apos;, $arguments). &quot;\n&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$obj = new MethodTest;</div><div class="line">$obj-&gt;runTest(&apos;in object context&apos;);</div><div class="line">MethodTest::runTest(&apos;in static context&apos;);</div><div class="line">?&gt;</div></pre></td></tr></table></figure><h3 id="get-，-set-，-isset-和-unset"><a href="#get-，-set-，-isset-和-unset" class="headerlink" title="__get()，__set()，__isset()和__unset()"></a><code>__get()</code>，<code>__set()</code>，<code>__isset()</code>和<code>__unset()</code></h3><p>当get/set一个类的成员变量时调用这两个函数。例如我们将对象变量保存在另外一个数组中，而不是对象本身的成员变量<br>var_dump($this-&gt;aa)<br>$this-&gt;aa = ‘pp’<br>isset($this-&gt;aa)<br>empty($this-&gt;aa)<br>值的注意的是 isset 和 empty 触发的魔术方法好像只能返回true和false<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;?php </div><div class="line">class MethodTest</div><div class="line">&#123;</div><div class="line">    private $data = array();</div><div class="line"></div><div class="line">    public function __set($name, $value)&#123;</div><div class="line">        $this-&gt;data[$name] = $value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public function __get($name)&#123;</div><div class="line">        if(array_key_exists($name, $this-&gt;data))</div><div class="line">            return $this-&gt;data[$name];</div><div class="line">        return NULL;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public function __isset($name)&#123;</div><div class="line">        return isset($this-&gt;data[$name])</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public function unset($name)&#123;</div><div class="line">        unset($this-&gt;data[$name]);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">?&gt;</div></pre></td></tr></table></figure></p><h3 id="sleep-和-wakeup"><a href="#sleep-和-wakeup" class="headerlink" title="__sleep()和__wakeup()"></a><code>__sleep()</code>和<code>__wakeup()</code></h3><p>当我们在执行<code>serialize()</code>和<code>unserialize()</code>时，会先调用这两个函数。例如我们在序列化一个对象时，这个对象有一个数据库链接，想要在反序列化中恢复链接状态，则可以通过重构这两个函数来实现链接的恢复。（还没有用到过）例子如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">class Connection </div><div class="line">&#123;</div><div class="line">    protected $link;</div><div class="line">    private $server, $username, $password, $db;</div><div class="line"></div><div class="line">    public function __construct($server, $username, $password, $db)</div><div class="line">    &#123;</div><div class="line">        $this-&gt;server = $server;</div><div class="line">        $this-&gt;username = $username;</div><div class="line">        $this-&gt;password = $password;</div><div class="line">        $this-&gt;db = $db;</div><div class="line">        $this-&gt;connect();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private function connect()</div><div class="line">    &#123;</div><div class="line">        $this-&gt;link = mysql_connect($this-&gt;server, $this-&gt;username, $this-&gt;password);</div><div class="line">        mysql_select_db($this-&gt;db, $this-&gt;link);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public function __sleep()</div><div class="line">    &#123;</div><div class="line">        return array(&apos;server&apos;, &apos;username&apos;, &apos;password&apos;, &apos;db&apos;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public function __wakeup()</div><div class="line">    &#123;</div><div class="line">        $this-&gt;connect();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">?&gt;</div></pre></td></tr></table></figure><h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString()"></a><code>__toString()</code></h3><p>对象当成字符串时的回应方法。例如使用<code>echo $obj;</code>来输出一个对象</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">// Declare a simple class</div><div class="line">class TestClass</div><div class="line">&#123;</div><div class="line">    public function __toString() &#123;</div><div class="line">        return &apos;this is a object&apos;;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$class = new TestClass();</div><div class="line">echo $class;</div><div class="line">?&gt;</div></pre></td></tr></table></figure><p>这个方法只能返回字符串，而且不可以在这个方法中抛出异常，否则会出现致命错误。</p><h3 id="invoke"><a href="#invoke" class="headerlink" title="__invoke()"></a><code>__invoke()</code></h3><p>调用函数的方式调用一个对象时的回应方法。如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">class CallableClass </div><div class="line">&#123;</div><div class="line">    function __invoke() &#123;</div><div class="line">        echo &apos;this is a object&apos;;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">$obj = new CallableClass;</div><div class="line">var_dump(is_callable($obj));</div><div class="line">?&gt;</div></pre></td></tr></table></figure><h3 id="set-state"><a href="#set-state" class="headerlink" title="__set_state()"></a><code>__set_state()</code></h3><p>调用<code>var_export()</code>导出类时，此静态方法会被调用。注意var_dump很强大，直接输出了，并不会触发。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">class A</div><div class="line">&#123;</div><div class="line">    public $var1;</div><div class="line">    public $var2;</div><div class="line"></div><div class="line">    public static function __set_state ($an_array) &#123;</div><div class="line">        $obj = new A;</div><div class="line">        $obj-&gt;var1 = $an_array[&apos;var1&apos;];</div><div class="line">        $obj-&gt;var2 = $an_array[&apos;var2&apos;];</div><div class="line">        return $obj;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$a = new A;</div><div class="line">$a-&gt;var1 = 5;</div><div class="line">$a-&gt;var2 = &apos;foo&apos;;</div><div class="line">var_dump(var_export($a));</div><div class="line">?&gt;</div></pre></td></tr></table></figure><h3 id="clone"><a href="#clone" class="headerlink" title="__clone()"></a><code>__clone()</code></h3><p>当对象复制完成时调用。例如在<a href="http://yansu.org/2014/04/19/sigleton-design-pattern.html" target="_blank" rel="external">设计模式详解及PHP实现：单例模式</a>一文中提到的单例模式实现方式，利用这个函数来防止对象被克隆。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;?php </div><div class="line">public class Singleton &#123;</div><div class="line">    private static $_instance = NULL;</div><div class="line"></div><div class="line">    // 私有构造方法 </div><div class="line">    private function __construct() &#123;&#125;</div><div class="line"></div><div class="line">    public static function getInstance() &#123;</div><div class="line">        if (is_null(self::$_instance)) &#123;</div><div class="line">            self::$_instance = new Singleton();</div><div class="line">        &#125;</div><div class="line">        return self::$_instance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    // 防止克隆实例</div><div class="line">    public function __clone()&#123;</div><div class="line">        die(&apos;Clone is not allowed.&apos; . E_USER_ERROR);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">?&gt;</div></pre></td></tr></table></figure><h2 id="魔术常量-Magic-constants"><a href="#魔术常量-Magic-constants" class="headerlink" title="魔术常量(Magic constants)"></a>魔术常量(Magic constants)</h2><p>PHP中的常量大部分都是不变的，但是有8个常量会随着他们所在代码位置的变化而变化，这8个常量被称为魔术常量。</p><ul><li><code>__LINE__</code>，文件中的当前行号</li><li><code>__FILE__</code>，文件的完整路径和文件名</li><li><code>__DIR__</code>，文件所在的目录</li><li><code>__FUNCTION__</code>，函数名称</li><li><code>__CLASS__</code>，类的名称</li><li><code>__TRAIT__</code>，Trait的名字</li><li><code>__METHOD__</code>，类的方法名</li><li><code>__NAMESPACE__</code>，当前命名空间的名称</li></ul><p>这些魔术常量常常被用于获得当前环境信息或者记录日志。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;有些东西如果不是经常使用，很容易忘记，比如魔术方法和魔术常量。&lt;br&gt;最主要是当看一些基本原理的代码的时候经常用到，比如闭包的时候，希望自己在学习过程中能对文章中的内容进行补充，改造，而不是单纯的靠这些简单例子来记忆&amp;gt;&lt;/p&gt;
    
    </summary>
    
      <category term="PHP" scheme="http://yoursite.com/categories/PHP/"/>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="面向对象" scheme="http://yoursite.com/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"/>
    
  </entry>
  
  <entry>
    <title>PHP函数</title>
    <link href="http://yoursite.com/2018/03/26/PHP%E5%87%BD%E6%95%B0/"/>
    <id>http://yoursite.com/2018/03/26/PHP函数/</id>
    <published>2018-03-26T06:12:29.000Z</published>
    <updated>2018-03-26T14:19:30.258Z</updated>
    
    <content type="html"><![CDATA[<p>工作的久了，反而基本功没有原先好了，也许要记得东西很多，内存中不够放置那些无规律的参数位置，但至少不要混淆哪些是框架自带的，哪些是PHP原生的。</p><a id="more"></a><p>一年多了，重复相同的工作可能让之前很多学会的但没用到的PHP函数忘记了，但这些在modern PHP 中，在新的环境中可能都是很重要的，记录下来。<br><!--more--></p><ol><li>string</li></ol><ul><li>str_repeat（’cy’, 10） //把cy这个字符串重复10次</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var_dump(str_repeat（&apos;cy&apos;, 10）)   //注意一定要打印，这个函数的作用只是构成一个字符串</div></pre></td></tr></table></figure><ul><li>var_dump 和 var_export<br>先来说下以后的使用都是使用var_dump,而不要使用var_export,因为第一个已经很强大了。<br>var_dump 可以输出数据类型，但是var_export不可以。<br>var_export 第二个参数给true, 他会把这个变量的值存储起来，可以用于赋值，但是当变量是resource的时候，返回的总是null,但是此时var_dump 虽然也不能打印出来，但是能<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">resource(2) of type (stream) </div><div class="line">NULL</div><div class="line">$a = var_export([2,3], true);</div></pre></td></tr></table></figure></li></ul><p>综上，用var_dump</p><ol><li>面向对象</li></ol><p>is_callable()与method_exists()     //method_exists 只能判断方法是否存在，但如果比如父类的方法是protected这种，没权利执行也会返回true，这种情况就得callable了，他会返回false<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">class Foo &#123;</div><div class="line">    public function PublicMethod()&#123;&#125;</div><div class="line">    private function PrivateMethod()&#123;&#125;</div><div class="line">    public static function PublicStaticMethod()&#123;&#125;</div><div class="line">    private static function PrivateStaticMethod()&#123;&#125;</div><div class="line">&#125;</div><div class="line">$foo = new Foo();</div><div class="line">$callbacks = array(</div><div class="line">    array($foo, &apos;PublicMethod&apos;),</div><div class="line">    array($foo, &apos;PrivateMethod&apos;),</div><div class="line">    array($foo, &apos;PublicStaticMethod&apos;),</div><div class="line">    array($foo, &apos;PrivateStaticMethod&apos;),</div><div class="line">    array(&apos;Foo&apos;, &apos;PublicMethod&apos;),</div><div class="line">    array(&apos;Foo&apos;, &apos;PrivateMethod&apos;),</div><div class="line">    array(&apos;Foo&apos;, &apos;PublicStaticMethod&apos;),</div><div class="line">    array(&apos;Foo&apos;, &apos;PrivateStaticMethod&apos;),</div><div class="line">   );</div><div class="line">foreach ($callbacks as $callback)&#123;</div><div class="line">    var_dump($callback);</div><div class="line">    var_dump(method_exists($callback[0], $callback[1]));</div><div class="line">    var_dump(is_callable($callback));</div><div class="line">    echo str_repeat(&apos;-&apos;, 10);</div><div class="line">    echo &apos;&lt;br /&gt;&apos;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;工作的久了，反而基本功没有原先好了，也许要记得东西很多，内存中不够放置那些无规律的参数位置，但至少不要混淆哪些是框架自带的，哪些是PHP原生的。&lt;/p&gt;
    
    </summary>
    
      <category term="PHP" scheme="http://yoursite.com/categories/PHP/"/>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="函数" scheme="http://yoursite.com/tags/%E5%87%BD%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>PHP知识点</title>
    <link href="http://yoursite.com/2018/03/26/PHP%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
    <id>http://yoursite.com/2018/03/26/PHP知识点/</id>
    <published>2018-03-26T06:08:38.000Z</published>
    <updated>2018-03-26T14:22:12.108Z</updated>
    
    <content type="html"><![CDATA[<p>PHP中很多稍微高级的知识点自己都不是很熟悉，trait, 闭包，又或者composer等， 记录下来，成为现代phper。</p><a id="more"></a><ol><li><a href="https://chenye2017.github.io/2018/03/26/PHP%E9%97%AD%E5%8C%85/#more" target="_blank" rel="external">PHP中闭包</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;PHP中很多稍微高级的知识点自己都不是很熟悉，trait, 闭包，又或者composer等， 记录下来，成为现代phper。&lt;/p&gt;
    
    </summary>
    
      <category term="PHP" scheme="http://yoursite.com/categories/PHP/"/>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>hi , swoole</title>
    <link href="http://yoursite.com/2018/03/23/hi-swoole/"/>
    <id>http://yoursite.com/2018/03/23/hi-swoole/</id>
    <published>2018-03-23T06:02:40.000Z</published>
    <updated>2018-03-24T07:15:07.336Z</updated>
    
    <content type="html"><![CDATA[<p>学习目的：想让自己从增删改查，做web，表单的生活中调出来。</p><a id="more"></a><ol><li>swoole的安装</li></ol><p>swoole作为PHP的一个扩展，用c语言开发，在使用他之前我们当然需要有php的基础环境。这里我们并不需要传统的lamp或者lnmp的架构，仅仅只要安装好php就行了。网上都说php最好编译安装，虽然我倒现在还不知道编译安装的好处，我看慕课上的那个教程也仅仅只是指定了php的安装文件夹。<br>首先要搭建我们的虚拟环境，强烈推荐vagrant，真的很方便，虽然他把镜像都放在了c盘，我也懒得改了，但其实自己平时练习的话一个镜像就够了，剩下的只要操作这个镜像就好了，我用的centos7。<br>安装好vagrant和vitrual box后去网上找镜像吧，<a href="http://www.vagrantbox.es/" target="_blank" rel="external">http://www.vagrantbox.es/</a>,挺快的，详细说明也有，我是先用迅雷下载到本地，然后再添加的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">vagrant box add centos7   d:/centos7.box      //把这个box文件装到系统中，之后这个box文件可以直接删除</div><div class="line">vagrant box list     //查看系统中是否有这个box文件的镜像</div><div class="line">vagrant box remove centos7   //如果这个镜像没用了，可以直接移除，节约c盘空间</div></pre></td></tr></table></figure></p><p>加入镜像后，就是去一个文件夹装载你的虚拟环境，他的底层是操作virtual box嘛，我的感觉就是和vitrual box那样找个文件夹存储这个虚拟环境。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">d:</div><div class="line">cd virtual                       //这是我平时虚拟环境统一放置的目录</div><div class="line">mkdir centos7             //为了区别开，这是我这次试验放置的目录，centos7代表镜像的名称</div><div class="line">cd centos7</div><div class="line">vagrant init centos7  //初始化虚拟环境，后面这个是上面添加进系统的镜像名称（这时候文件夹会生成vagrant的虚拟环境）</div><div class="line">修改vagrant file      //配置共享文件夹，开启ip地址</div><div class="line">vagrant up   //启动虚拟机（会重启加载上面配置文件的内容）</div></pre></td></tr></table></figure></p><p>几个命令很长时间使用哦<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vagrant halt    //关闭虚拟机</div><div class="line">vagrant suspend  //挂起虚拟机</div><div class="line">vagrant resume  //唤醒虚拟机，对应上面的挂起，这样就不用每次启动了，就和linux永不关机都可以一样</div><div class="line">vagrant destroy  //摧毁虚拟机，没用的即使删除，虽然感觉也不占多大地方</div><div class="line">vagrant reload //这个我用的不多，主要是不记得他是否会重新加载配置文件了</div></pre></td></tr></table></figure></p><p>上面的一些坑就是：</p><ol><li>把镜像纳入系统的时候，默认会放在c盘，virtual box 也有些文件放在c盘，导致c盘越来越小。</li><li>加入镜像的时候，镜像的名称最好取得有点意义，比如ubuntu1604 这种，以后用起来的时候方便，时间长了，自己都忘记了。</li><li>不要用ubuntu16.04这种，之前用过这种，虽然添加镜像的时候没有啥问题，但是后面启动虚拟机的时候会报错。</li><li>挂载文件夹的问题。之前下载了ubuntu的box文件和centos56 的box文件，ubuntu能挂载上，centos挂载不上，网上说是vitrualbox的原因，可我都升级到2.0了都没法解决，仔细看了报错信息，说可能是这个box文件的问题。后来新下载了centos7的box文件，reslove。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vagrant ssh  //进入虚拟机，注意要在上面建立的装载虚拟环境的文件夹下使用</div></pre></td></tr></table></figure><p>上面就是基础环境的搭建，可以理解成系统的搭建，剩下的就要我们去虚拟机中进行处理了。</p><p>首先是php的编译安装<br><a href="https://segmentfault.com/a/1190000004123048#articleHeader0" target="_blank" rel="external">这篇文章里面写的很清楚</a>，源码是我去php.net上面下载的。然后去swoole.php上面下载swoole的源码。phpize,这是php源码编译后的一个命令，按照上面那篇博客应该是在/usr/loca/php7/bin 下面，这是因为swoole的源码包下面没有configure文件，产生后./configure,可能会报找不到php-configure,注意这里面不是php 的配置文件，而是php7那个文件夹bin命令下面有个php-configure，直接写这个地址就可以了。</p><p>遇到的坑。编译出错，直接执行make，显示找不到configure文件，··其实./configure那时候就报错了，我不知道，直接执行make，然后显示找不到目标，注意一下报错信息，其实这些编译的时候都没什么错误，或者把错误信息粘贴去百度google，很容出来。<br>注意要在php.ini 里面开启扩展 extension=swoole<br>因为我们这没有lamp环境嘛，不要想着在页面访问phpinfo,直接php -m,查看加载的扩展。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;学习目的：想让自己从增删改查，做web，表单的生活中调出来。&lt;/p&gt;
    
    </summary>
    
      <category term="PHP" scheme="http://yoursite.com/categories/PHP/"/>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="swoole" scheme="http://yoursite.com/tags/swoole/"/>
    
  </entry>
  
  <entry>
    <title>自己的http记录</title>
    <link href="http://yoursite.com/2018/03/07/%E8%87%AA%E5%B7%B1%E7%9A%84http%E8%AE%B0%E5%BD%95/"/>
    <id>http://yoursite.com/2018/03/07/自己的http记录/</id>
    <published>2018-03-07T09:49:37.000Z</published>
    <updated>2018-04-01T02:46:23.845Z</updated>
    
    <content type="html"><![CDATA[<p>上周老师让我们写一个关于http的总结，记录下这些天来的自己关于http的认识。</p><a id="more"></a><p>1.http请求动作</p><p>移动互联网时代，不像之前web时代，实现了前后端的分离，前端请求后端接口从之前基于soap变成调用基于rest的restul api接口，restful api是基于资源，他对于不同的http请求方式有不同的含义，最常见的get，post，put，delete, option,。传统的get和post区别主要是一个是url明文传递，另一个是加密后传递更安全。但是restful api中常见的4中请求动作分别代表一下含义<br>get ： 对于资源的请求<br>post ： 对于资源的创建<br>put ： 对于资源的更新<br>delete ： 对于资源的删除<br>例如 : get  /users/1  代表获取用户1的信息<br>post /users/1 创建<br>put /users/1  更新<br>delete /users/1  删除<br>这样的好处之一就是更有利于语义化，而且更能指定统一的标准, 比如laravel里面Route的resource方法就能根据资源users统一生成一堆的url，而不是通过不同的方法名来区分。<br>但比如传统表单提交只能实现get 和 post方式，如果我们直接修改提交方式会报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;form action=&quot;/posts/62&quot; method=&quot;POST&quot;&gt;</div></pre></td></tr></table></figure><p>我们只需要在里面增加一个隐藏的input<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;input type=&quot;hidden&quot; name=&quot;_method&quot; value=&quot;PUT&quot;&gt;</div></pre></td></tr></table></figure></p><p>就可以改变原先的form表单提交方式了</p><p>2.content-type的作用</p><ul><li><p>对于接口返回数据的处理</p><p>以python flask为例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">from flask import Flask, make_response</div><div class="line"></div><div class="line">app = Flask(__name__)</div><div class="line"></div><div class="line">@app.route(&apos;/hello&apos;)</div><div class="line">def hello():</div><div class="line">    response = make_response(&apos;&lt;html&gt;&lt;/html&gt;&apos;)</div><div class="line">    return response</div><div class="line"></div><div class="line">app.run(host=&apos;0.0.0.0&apos;, debug=True)</div></pre></td></tr></table></figure><p>默认浏览器是按照html的格式解析的，上面当我们访问/hello的时候输出是空，因为html标签里面什么也没有</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">app = Flask(__name__)</div><div class="line"></div><div class="line">@app.route(&apos;/hello&apos;)</div><div class="line">def hello():</div><div class="line">    headers = &#123;</div><div class="line">        &apos;content-type&apos;:&apos;text/plain&apos;,</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    response = make_response(&apos;&lt;html&gt;&lt;/html&gt;&apos;)</div><div class="line">    return response</div><div class="line">app.run(host=&apos;0.0.0.0&apos;, debug=True)</div></pre></td></tr></table></figure><p>但这样就能输出 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;&lt;/html&gt;</div></pre></td></tr></table></figure><p>因为我们让浏览器按照字符串的形式来解析</p><p>itbasic中也对header信息做了设置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$response-&gt;header(&apos;Content-Type&apos;, &apos;text/json&apos;);</div><div class="line">        $response-&gt;header(&apos;Access-Control-Allow-Origin&apos;, &apos;*&apos;);</div><div class="line">        return json_encode($res);</div></pre></td></tr></table></figure><p>这就是为什么我们每次调用接口的时候返回的都是json数据的原因</p><p>但是当我们输出模板的时候，观察控制台返回的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Content-Type: text/html; charset=UTF-8</div></pre></td></tr></table></figure><p>应该是模板在哪里进行了处理</p></li></ul><ul><li>常见的输出图片</li></ul><p>content-type 属于返回内容的一部分，主要是用来告诉浏览器返回的数据应该怎么解析，比如你访问 homestead.app/1.jpg,并不是根据文件的后缀名解析的成相应的文件，而是根据resresponse headers里面的内容，<a href="http://tool.oschina.net/commons" target="_blank" rel="external">常见的mini type</a>。例如php输出一张图片</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$fileres = file_get_contents(&apos;./1.jpg&apos;);</div><div class="line">header(&apos;Content-type: image/jpeg&apos;);</div><div class="line">echo $fileres;</div></pre></td></tr></table></figure><ul><li>不使用插件导出excel文件</li></ul><p>其实这个作用还是挺大的，比如我们经常输出的excel，虽然php有个很强大的插件phpexcel，但是那种东西经常就内存溢出了，我们可以通过修改header，直接输出csv文件，而不用使用任何插件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 导出excel(csv)</div><div class="line"> * @data 导出数据</div><div class="line"> * @headlist 第一行,列名</div><div class="line"> * @fileName 输出Excel文件名</div><div class="line"> */</div><div class="line">function csv_export($data = array(), $headlist = array(), $fileName) &#123;</div><div class="line">  </div><div class="line">    header(&apos;Content-Type: application/vnd.ms-excel&apos;);</div><div class="line">    header(&apos;Content-Disposition: attachment;filename=&quot;&apos;.$fileName.&apos;.csv&quot;&apos;);</div><div class="line">    header(&apos;Cache-Control: max-age=0&apos;);</div><div class="line">  </div><div class="line">    //打开PHP文件句柄,php://output 表示直接输出到浏览器</div><div class="line">    $fp = fopen(&apos;php://output&apos;, &apos;a&apos;);</div><div class="line">    </div><div class="line">    //输出Excel列名信息</div><div class="line">    foreach ($headlist as $key =&gt; $value) &#123;</div><div class="line">        //CSV的Excel支持GBK编码，一定要转换，否则乱码</div><div class="line">        $headlist[$key] = iconv(&apos;utf-8&apos;, &apos;gbk&apos;, $value);</div><div class="line">    &#125;</div><div class="line">  </div><div class="line">    //将数据通过fputcsv写到文件句柄</div><div class="line">    fputcsv($fp, $headlist);</div><div class="line">    </div><div class="line">    //计数器</div><div class="line">    $num = 0;</div><div class="line">    </div><div class="line">    //每隔$limit行，刷新一下输出buffer，不要太大，也不要太小</div><div class="line">    $limit = 100000;</div><div class="line">    </div><div class="line">    //逐行取出数据，不浪费内存</div><div class="line">    $count = count($data);</div><div class="line">    for ($i = 0; $i &lt; $count; $i++) &#123;</div><div class="line">    </div><div class="line">        $num++;</div><div class="line">        </div><div class="line">        //刷新一下输出buffer，防止由于数据过多造成问题</div><div class="line">        if ($limit == $num) &#123; </div><div class="line">            ob_flush();</div><div class="line">            flush();</div><div class="line">            $num = 0;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        $row = $data[$i];</div><div class="line">        foreach ($row as $key =&gt; $value) &#123;</div><div class="line">            $row[$key] = iconv(&apos;utf-8&apos;, &apos;gbk&apos;, $value);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        fputcsv($fp, $row);</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure><ul><li>文件的上传</li></ul><p>之前在调用datrix的上传接口的时候，他要求传过来的数据文件得是form表单的g格式，可以通过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var writeData = new FormData();</div></pre></td></tr></table></figure><p>3.http是无状态的协议（cookie 和 session）<br>无状态的协议代表我们在登录网站后，浏览器不知道我们在不同的网页间是同一个个体，这就得靠session和cookie了。<br>session和cookie都能保存用户信息，只是一个存储在客户端，另一个存储在服务器端。存储在客户端就说明用户可以进行修改，不安全，所以一般开启session后，服务器返回给用户一个session id,下次用户登录的时候，拿着这个session id 去服务器端获取session文件。<br>php里面默认的cookie 名字是PHPSESSID 里面装的是sessionid的内容(这个名字是可以改的，比如laravel框架里面默认的是laraval<em>session,这个也是可以通过配置文件改的)，只要拿着这个去服务器端sess</em> + sessionid的内容（这个存储地址在php.ini里面有配置），就能找到对应的session，session里面的内容是序列化后的（如果客户端禁止了cookie，也可以把session id 放在url里面带过来）。默认这个session id的cookie是种在 域名下。比如 itbasic.datatom.com,这个域名下的所有网页都可以访问（只有同一个浏览器，如果是不同的浏览器，就获取不到这个cookie了··）</p><p>文件1 ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line"></div><div class="line">session_start();</div><div class="line"></div><div class="line">$_SESSION[&apos;username&apos;] = &apos;cy&apos;;</div></pre></td></tr></table></figure></p><p>文件2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">session_start();</div><div class="line">var_dump($_SESSION);</div></pre></td></tr></table></figure></p><p>notice: <strong>这个获取session的时候也要调用session_start（）函数，有时候因为框架的或者函数的封装，很容易忽略</strong></p><p>4.http 状态码<br>http状态码表示这个请求的状态，常用的有200成功 ，3xx 资源的重定向，4xx客户端的错误（404 请求的文件找不到 403 没有权限 401 没有登录）， 5xx服务器端错误（500 经常代码的错误  502 网关，经常nginx出错）。然后现在的restful api在我们返回客户端的请求内容的时候经常也会携带着一个状态码，比如 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">return json_encode([</div><div class="line">      &apos;errorCode&apos;=&gt;10001,</div><div class="line">      &apos;errorMsg&apos;=&gt; &apos;xxx&apos;,</div><div class="line">      &apos;result&apos;=&gt;[]</div><div class="line">])</div></pre></td></tr></table></figure><p>errorCode一般是我们内部定义的错误状态码，可以展示给用户看，让用户更能清楚的了解问题的所在，举个例子就是文章的创建，可能title不合法，过长了，文章删除的时候没有传递id，都可以以一个具体位数开头的错误码，归于一类。<br>不管是http状态码，还是我们传递给用户的状态码，都是可以改变的，比如tp里面的json方法，第一个参数就是http状态码的参数，第二个参数才是要返回的具体的内容。</p><p>location也是返回信息中的一个字段，虽然状态码和我们的返回信息没有关系，即使正常调用接口我们返回一个404也是可以的，但是location必须得配合30x才能实现页面的跳转。</p><p>5.无连接<br>无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。记得之前好像看过一篇文章说现在的http协议支持长连接了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Connection:keep-alive</div></pre></td></tr></table></figure><p>在请求头里面包括这个东西，虽然自己平时好像从来也没感受到，但还是记录下</p><p>6.url</p><ul><li>url组成</li></ul><p>统一资源定位符。比如<a href="http://itbasic.datatom.com:80。" target="_blank" rel="external">http://itbasic.datatom.com:80。</a><br>http 是网络协议，默认端口80，如果不是80，需手动添加，比如我本地的xampp修改了http默认端口8080，访问的时候itbasic.app:8080才能访问，除了http，还有https 443， ssh默认端口22，访问这些服务的时候都要加上端口号，除了域名之外。其实域名只是为了让人们更好的记住，其实它本质上是翻译成ip的，打开cmd，ping itbasic.datatom.com 就能看到ip地址。ip地址代表服务器，一个服务器上可能提供多种服务，比如web服务，为了识别出不同的服务，我们用端口号进行标识，这和之前说的刚好吻合。</p><ul><li>域名解析</li></ul><p>其实当我们在浏览器中输入itbasic.datatom.com 的时候，浏览器会先去找比如windows host文件（经常我们本地测试的时候，瞎写的域名能访问就是这个道理，他不会去网络上进行解析，而是根据hosts文件中的配置进行ip地址转换，可以测试一下把www.baidu.com ip地址换成itbasic的，当然只有自己这台电脑访问百度会显示的是itbasic的主页），如果找不到，寻找浏览器缓存，再找不到会进行DNS域名解析，最终找到服务器，给他发送http请求，如果是传统的lamp架构，apache接受到请求会把通过模块加载的形式把关于php的内容传递给php进行解析，php会把其中关于数据库的内容，交给数据库处理，返回来的数据处理后统一返回给apache，再返回到浏览器进行渲染。现在lnmp，利用nginx，fpm对php请求进行统一处理，自己关于这方面内容现在还不足，了解还不是很深。</p><ul><li>跨域</li></ul><p>itbasic.datatom.com中 com是一级域名，datatom是二级域名，itbasic是三级域名，同属于datatom,这个二级域名下还会有很多，比如blog.datatom.com,51dan.datatom.com,域名的不同会导致出现跨域的问题，之前看网上处理方式主要分为两大类，一种是jsonp,另一种是返回的请求头中添加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&apos;Access-Control-Allow-Origin&apos;, &apos;*&apos;</div></pre></td></tr></table></figure><p>7.请求头<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">GET /562f25980001b1b106000338.jpg HTTP/1.1</div><div class="line">Host    img.mukewang.com</div><div class="line">User-Agent  Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.106 Safari/537.36</div><div class="line">Accept  image/webp,image/*,*/*;q=0.8</div><div class="line">Referer http://www.imooc.com/</div><div class="line">Accept-Encoding gzip, deflate, sdch</div><div class="line">Accept-Language zh-CN,zh;q=0.8</div></pre></td></tr></table></figure></p><p>第一行get代表请求方式， 后面那个是请求的资源，最后是http的版本号，话说http 1.0 和 http1.1 使用时间好长<br>第二行host 代表主机名<br>第三行 表示 访问的主机的系统，还有浏览器，经常通过这个来判断是手机还是电脑登录。其实这个在服务器端也是可以获取的，通过打印 $_SERVER 数组。<br>第四行<br>第五行 上一个链接地址，经常用来进行回退。<br>这个请求头和后面传递的数据需要空一行。<br>这个请求头里面还可以放置很多别的数据，比如laravel里面表单为了放置csrf攻击，在里面放置了额外的参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;meta name=&quot;csrf-token&quot; content=&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;&gt;</div></pre></td></tr></table></figure></p><p>请求的时候建立连接还会有4次握手</p><ol><li>你在吗</li><li>我在</li><li>那我给你发数据了</li><li>好的，你发吧<br>虽然到今天还没用上过</li></ol><p>8.返回信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">HTTP/1.1 200 OK</div><div class="line">Date: Fri, 22 May 2009 06:07:21 GMT</div><div class="line">Content-Type: text/html; charset=UTF-8</div><div class="line"></div><div class="line">&lt;html&gt;</div><div class="line">      &lt;head&gt;&lt;/head&gt;</div><div class="line">      &lt;body&gt;</div><div class="line">            &lt;!--body goes here--&gt;</div><div class="line">      &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p><p>这个和上面的请求消息差不多，断开链接需要3次握手</p><ol><li>我要断开链接了</li><li>好的 （我不发送数据）</li><li>我也要断开连接了（这下两条都断开了）</li></ol><p>9.https</p><p>https 默认端口443，其实他不是一种新的协议，他还是http协议，只是在外层包裹了ssl。</p><p>https传输数据比http安全大家都知道，但原因呢，是由于数据进行了加密。很早之前有种协议talent，他也是通信协议，默认端口23，但现在这个端口默认都被禁止掉了，原因就是他传输数据的过程是明文传输，导致别人用抓包工具抓到了请求，或者监听这个端口，直接就能获取客户端传递过来的数据。想象一下，钓鱼网站如果用这个，很容易就能获取到用户的密码，太不安全了，于是ssh诞生了（我猜的）。ssh用的地方很多，比如我们用xshell时候建立的连接，还记得我们第一次连接新的服务器的时候的弹窗吗</p><blockquote><p>一次性接受密钥</p></blockquote><p>这是什么东西？这其实就是服务器的公钥。你发给服务器的内容，用服务器的公钥进行加密，服务器接收到你的内容用私钥进行解密，保证了数据传输的安全性（你发送的数据只有服务器能查看到，别人永远不能查看，因为你加密的媒介是计算机的公钥，能解密的只用服务器的私钥，而服务器的私钥只有你自己有，so，数据绝对安全。但有一点，数据的不可变性，就是数据的被篡改性不能得到保证）。或者你是否记得第一次对github进行提交的时候，或者换新的机器对github进行提交的时候，需要在github上贴你的公钥，为什么呢？因为我们git clone代码的时候，需要让github用我们的公钥加密，然后我们用自己的私钥进行解密（git clone 的时候的地址有ssh和https之分）</p><p>上面说的公钥加密，私钥解密舒服非对称加密，记得有RSA算法之类的。但是我们在数据通信的过程中如果一直用非对称方式进行数据传输，消耗会很大。于是我们用了另一种对称加密。对称加密顾名思义就是：同一种密钥进行加密解密，简单。可问题来了，这个密钥如果被获取到，加密就毫无意义了，我们该如何传递这个密钥给客户端。我们不能预先在所有的客户端都放置所有的密钥吧，这样不现实，也不能变动。</p><p>上面说的第一种非对称加密是公钥加密，私钥解密，保证数据的安全性。其实我们还可以通过私钥加密，公钥解密的方式，这样虽然不能保证数据的安全性（指的是被别人获取，因为公钥的公开性），但可以保证数据的不被篡改，因为私钥的私密性，一旦篡改内容，我们没法复原到私钥加密前的状态，我们只需要在私钥加密的内容中添加一些公共的东西，比如一个值，一个算法，这个值经过算法加密后的值，当我们通过公钥解密后这这个值加密后不等于这个算法加密后的值，那我们就能发现文件内容被篡改。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上周老师让我们写一个关于http的总结，记录下这些天来的自己关于http的认识。&lt;/p&gt;
    
    </summary>
    
      <category term="http" scheme="http://yoursite.com/categories/http/"/>
    
    
      <category term="http" scheme="http://yoursite.com/tags/http/"/>
    
  </entry>
  
  <entry>
    <title>正则表达式</title>
    <link href="http://yoursite.com/2018/02/27/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <id>http://yoursite.com/2018/02/27/正则表达式/</id>
    <published>2018-02-27T03:55:54.000Z</published>
    <updated>2018-02-27T10:20:54.004Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="工具" scheme="http://yoursite.com/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="工具" scheme="http://yoursite.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
      <category term="正则表达式" scheme="http://yoursite.com/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>python学习笔记</title>
    <link href="http://yoursite.com/2018/02/22/python%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2018/02/22/python学习笔记/</id>
    <published>2018-02-22T01:52:26.000Z</published>
    <updated>2018-03-05T03:29:53.426Z</updated>
    
    <content type="html"><![CDATA[<p>虽然自己是写php的，但现在python这么热门，而且想挑战一下自己，多学点东西，感觉python的用途非常广泛，反正就是能给自己加分的选项。</p><a id="more"></a><ol><li><p>运行环境<br>python和php一样，也是脚本语言，解释型语言， 翻译一行，执行一行。python运行环境的安装很简单，直接去官网上下载，我是windows，所以下载了合适的exe文件，双击运行就可以了。<br><img src="http://ozys8fka7.bkt.clouddn.com/python%E5%AE%89%E8%A3%85.png" alt="python安装界面"><br>勾选下面的添加到环境变量，直接在cmd中敲击python，就能进入交互界面，这个customize其实就是选择python的安装位置，放在c盘还是哪，别的没有多少变化。<br>想了一下关于php的，其实当时对php的安装理解错了，不管是xampp，还是lamp的编译安装，都是对整个架构lamp的安装，并不单单是php，所以相对而言复杂些。lamp整个架构安装的成功，可以通过浏览器去请求，php进行处理，从数据库中获取数据这些一系列的功能。如果我们单单只是想编译php代码（因为php大部分用来web，所以这种情况比较少，这也是我们一直用集成环境的原因），单单安装php就可以，同样也是去php的官网上下载exe文件。<br>python代码的执行python xx.py,php其实也是类似的，php -c 指定配置文件xx.php,lamp的本质执行php文件就是这样。<br>python，php，bash这些脚本文件还可以直接执行，并不用在前面加上解释器的名字，在文件的开头加上这些注释：#!/usr/bin/env python3，php，bash都可以，加上注释的好处是为了执行的时候的兼容性。<br>别用word和记事本写代码！！！</p></li><li><p>字符编码<br>廖雪峰的教程中提及的字符编码，ascii，utf-8,unicode,这三种，其实理解的并不是很深。后面的bytes类型，并不是很懂。<br>首先是ascii，早些时候，为了表示大小写字母，一些特殊符号，用8位二进制字符表示的东西，其实只有7位在用，最高的一位代表着正负号。<br>后来，为了表示中文，中文这么多汉字，ascii那点数量已经不够用了，出现了GB2312，可是日本韩国那些也出了对应自己文字的标准，为了实现兼容出现了Unicode，可是unicode中每个字符长度一致，导致很浪费，比如A你用一个很长的字符进行编码，后来就出现了针对节约空间的utf-8，字符变长。<br>其实Unicode还有utf-8都是兼容ascii的，对于ascii中已经存在的字符要么是没有变化，要么仅仅就是在前面补位0就可以了。<br><img src="http://ozys8fka7.bkt.clouddn.com/%E5%AD%97%E7%AC%A6%E8%BD%AC%E6%8D%A2.png" alt="字符编码关系"></p></li><li><p>重要的数据类型<br>首先是list，这个我得理解就是类似队列一样的东西，在php中可以看做索引数组。<br>初始化  a = [1,2,3,]<br>取元素 a[0]<br>末尾加元素  a.append(6)<br>删除元素  末尾直接删除 a.pop()  返回的是要删除的元素<br>删除特定的元素a.pop（0） 删除第一位元素<br>添加到特定位置元素a.insert(0,88) 在首位添加元素88</p></li></ol><p>tuple 不可变的链表，初始化 a=(0,)<br>注意只有一个元素的时候一定要在末尾加上逗号<br>tuple虽然不可以变化，但是这种（9，[1,2]）=&gt;(9, [2,3]) 还是可以的<br>但这个赋值还不能 a[1] = [2,3] 这种<br>只能a[1][0] = 2这种单独改变<br><img src="http://ozys8fka7.bkt.clouddn.com/tuple%E7%9A%84%E4%B8%8D%E5%8F%AF%E5%8F%98.png" alt="tuple的不可变"><br>只是针对第一层结构的不可变</p><p>dict 字典，类似php的关联数组，无序，类似数据结构的链表，查找添加速度元素块，类似字典中查找字的方法。<br>初始化 a =  {2:’222’}<br>获取元素和之前的还是一样 a[2]<br>因为是无序的，所以不能用数字啦<br>添加元素很简单，直接a[‘ll’] = ‘pp’ 这种方式<br>删除元素 a.pop(‘ll’)</p><p>set 集合，就是dict的key部分，so也是无序的<br>初始化 a = set([9,9,9])  感觉是强制转换<br>因为dict的key不能重复，所以上面的初始化后还是 9<br>添加元素 a.add(10)<br>删除元素 a.remove(10)<br>集合··差，并，交</p><p>不可变对象<br>str不可变，tuple不可变</p><p>可变<br>list可变，dict可变</p><p>str的不可变，其实在别的语言中也是，只是廖雪峰的教程中有强调，比如在js教程中，其实php中也是如此，对str本身的改变并不影响str本身，只是返回了一个新的str。<br>还有就是dict的key，必须是不可变对象，否则key的实际值总变换，查询到的value总在变化，那就乱了套了。</p><ol><li>常见的结构<br>if elif else<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mod = 3</div><div class="line"></div><div class="line">if mod == 1:</div><div class="line">    print(&apos;cy is good&apos;)</div><div class="line">elif mod == 2:</div><div class="line">    print(&apos;cy is bad&apos;)</div><div class="line">else:</div><div class="line">    print(&apos;ccc&apos;)</div></pre></td></tr></table></figure></li></ol><p>感觉写python就不要在末尾加 ;<br>判断条件可以是表达式，不要加括号<br>注意条件语句末尾加：<br>用缩进代替 {}</p><p>for in 进行循环遍历<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a = &#123;&apos;pp&apos;: &apos;oo&apos;, &apos;rr&apos;: &apos;pppp&apos;&#125;</div><div class="line">for x in a:</div><div class="line">    print(x)</div></pre></td></tr></table></figure></p><p>函数的定义<br>def print_function(a):<br>      for key,value in a.items():<br>            print(a+’–’+value)</p><p>类的定义<br>class  ClassName(object):</p><ol><li>零碎的知识点</li></ol><ul><li>python中的注释，单行是 #，多行是 ``` ``` </li><li>python的代码不能压缩，因为if 后面的空格是必须的，压缩之后就没有当初的意义了</li><li>python里面的if 表达式好像不用用括号包围起来，然后表达式不能用赋值语句，感觉这些虽然在别的语言里面可以用，但是本质上用这个不规范，感觉还是不用比较好</li><li>python里面变量的命名用驼峰法，然后如果变量位于模块里面而不是类下面，会被直接认为是常量</li><li>python的代码规范是pylint，要求python代码结尾需要一个空行</li><li>除了：，剩下的运算符两边好像都需要空格，python文件的开头（模块的开头），一般都有个doc文档描述</li><li>python的缩进是4个空格</li><li>感觉逻辑运算符应该就是 and or这种， 但是 &amp;和|挺方便所以用的比较多，所以以后感觉python中还是多使用 and 和 or比较好</li><li>python中没有我们那种for（） 循环，只有一种循环就是for in，如果想用数字那种控制循环条件，可以通过range构造一个类似list的东西，rang（start, end, step）,包括开始，不包括结束，最后一个参数代表每步的大小，python中还有个切片，功能一致。a = [0:len(b):2],只是这个输出的直接是一个list</li><li>python中的组织结构：包（文件夹）模块（文件）类，虽然python中一个模块可以包括多个类，但是最好还是只包括一个，这样更符合规范</li><li>python中除了类名，首字母大写，后面用驼峰法，好像剩下的所有的都用_ 进行分割</li><li>包在外表物理形式上是类似于文件夹的，但是文件夹并不一定是包，要想成为包，必须的有个<strong>init.py</strong> 这个文件夹（里面的内容是空的，可以随便写，现在我还不知道他有什么用）</li><li>导入包邮两种形式  import a , from a import hello，hello2, hello3,第一种在使用变量的时候需要加上包的名称，第二种在使用的时候直接使用hello就可以了(连着导入了三个变量)</li><li>__pycache__ 二进制文件夹，感觉应该是缓存文件，可以 加速python的编译执行,这个文件夹里面的内容是没有用的</li><li>import 包名的时候也可以用 as，用来简化包名</li><li>不管是导入包，还是导入包下面的文件 <strong>init.py</strong> 都会被自动的执行</li><li>几个比较常见的内置变量<br><strong>doc</strong>: 文件的注释<br><strong>file</strong> : 文件的物理位置<br><strong>package</strong>: 代表文件的包名，文件外层文件夹的名称<br><strong>name</strong>:代表文件的名称，没有后缀</li><li>python可以同时返回多个值，return a,b ，其实这是返回一个tuple，感觉是不是tuple可以不用（）包裹起来 a,b,c = (1,23,3) 这样赋值了，php也有类似的功能。list(a,b) = [0,1],只能用于索引数组</li><li>python 中字符串的连接用的是 +， python中函数的调用参数可以不按照顺序返回，只需指定变量名就可以了</li><li>python中的可变参数，比如print可以接受任意多个参数。def print_function(<em>param),这样打印出来的param是一个tuple，如果print_function(</em>(1,2,3)), 这样打印出来的依旧是tuple，但是如果直接print_function((1,2,3)),这样打印出来的就是二维数组了(不止是tuple，list这些也是可以的)</li><li>作用域：python中for和php，js都一样，构成不了作用域，es6里面用的let。import代码的时候其实是把不同的代码拼装在了一起，import的文件里面如果有可执行的内容，都是会被执行的</li><li>函数内部的变量本来是不能被执行的，但是如果在函数内部定义了global c.单独起一行，这样就能在函数外面也可以使用</li><li>php类里面的定义没有参数（），python里面类的定义有（）</li><li>类中方法的定义一定要传入参数，self</li><li><strong>init</strong> 是类的构造方法，也要传入参数self感觉self在python类中属于实例。self.name  代表这个类的实例属性，即使这个类没有类变量name也没有关系（注意这个self只是一个变量的名称，是可以改变的，不属于关键字范畴）</li><li>python中类Test().name 可以直接调用类属性</li><li>上面这种直接使用类变量一般用在类的外部，如果在类的内部使用，一般是不可以的，如果实在想使用，用self.<strong>class</strong>.name  这样使用</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;虽然自己是写php的，但现在python这么热门，而且想挑战一下自己，多学点东西，感觉python的用途非常广泛，反正就是能给自己加分的选项。&lt;/p&gt;
    
    </summary>
    
      <category term="Python" scheme="http://yoursite.com/categories/Python/"/>
    
    
      <category term="Python" scheme="http://yoursite.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>关于token</title>
    <link href="http://yoursite.com/2018/02/07/%E5%85%B3%E4%BA%8Etoken/"/>
    <id>http://yoursite.com/2018/02/07/关于token/</id>
    <published>2018-02-07T08:04:23.000Z</published>
    <updated>2018-02-23T12:50:02.865Z</updated>
    
    <content type="html"><![CDATA[<p>关于token。<br>故事背景：itbasic用vue做了个手机版，之前是用jquery识别是手机还是web实现页面上元素的尺寸变化，实现兼容，但是页面其实还是同一个。所以通过dom元素绑定的后台请求ajax，api接口可以通用。现在用了vue，这种mvvm模式的框架，需要后台返回纯json格式的数据，并不需要之前接口中可能返回的html，实现页面元素的变化，这样一来，很多接口得重写。之前的itbasic更像是远古时代的web，调用接口的基本权限控制用的是session里面存储的登录用户信息，而itbasic的web端更像是现代的web网站，调用接口不需要用户登录，而是通过令牌，也就是token进行身份认证。</p><a id="more"></a><ol><li><p>token肯定要保存的啦,保存的内容有哪些？<br>从上面可以看出token的作用就和之前的session作用是一样的，因为session中存储了用户的基本信息，我们可以通过解析session数组，从中获取自己有用的东西，但我们的token一般只是一串无意义不重复的数字，所以光靠token是实现不了用户的区分的，所以我们一般在缓存中保存（为什么是缓存呢，我觉得首先返回给客户端的token信息不重要，并不用都保留下来，还有就是频繁的调用api接口，如果我们每次都去数据库中取缓存，太多的与数据库的交流并不好）。那我们需要保存的内容有哪些呢？最基本的用户的uid，因为我们一个token需要区分一个用户，我们得通过token知道这个用户是谁，当然你可以保存的不单单是uid，你可以理解成token是session数组的session_id,session数组就是我们token可以对应的内容，你可以在里面存放用户权限，登录时间，等一些常用的信息，这样就不需要为了取一些常用的信息的时候，先通过token找到用户id，再通过数据库查找这个用户的相关信息，再返回。token对应的内容只要你乐意，随便存储什么，但最基本的应该有个uid哦。</p><p>​总结：token保存在缓存中，并不用记录在数据库中，保存的内容是和uid                     的对应关系。</p></li><li><p>token的产生<br>其实之前我一直纠结怎么生成一个token，网上有很多算法，后来呢，感觉如果安全性不用太高的话。取一堆字符串，从中随机取个，通过mt_rand()，然后拼接下，你也可以再拼接个你自己的盐，再加上时间戳这种的东西，再md5（）加密下。(js,php这些都有md5加密的，同样的内容，不管通过什么语言md5加密应该是一样的）。<br>总结：方法很多，自己想吧，别太纠结了</p></li><li><p>token有过期时间<br>和session一样啦，不能请求一次就一直可以使用啦。</p></li><li><p>token一般放在cookie里面，这样请求接口的时候就不用一直带上这个参数了。</p></li><li><p>token的申请。<br>token需要和用户相对应，这种对应关系怎么知道呢。在之前做的微信小程序登录接口中是这样做的。</p><ol><li>首先用户通过登录小程序获得一个code码（还记得我们每次进入小程序的时候都有个允许授权吗），这个码可以换取对应这个用户在这个小程序里面的一个独一无二的openid，可以理解成类似uid的东西，我们一旦获取到这个openid，意味着就相当于我们多了个用户uid，我们在自己的用户表中存储这个openid。（为什么要用code换区openid呢，可以理解成openid比较重要，包含用户的重要信息，而且类似uid，永远不会变，一旦获取，就代表永远知道了，这个不能用来表示身份，或者说通过openid不能换取表示身份的token，所以还是放在服务器端吧。古代的用户密码登录因为有只有自己知道的密码，所以可以通过固定不变的大家可能都知道的用户名换区session_id,现在通过变化的code同样的道理，code理解成密码，服务器端给这个密码给微信，微信通过自身维护的code和openid的对应关系，把用户openid返回给你，注意这个code只能用一次哦）</li><li>服务器收到这个openid， 生成和这个用户相匹配的token，存储对应关系在缓存中，再返回给客户端token。客户端拿着这个token再来服务器端请求数据，服务器端看token是否存在和token是否失效，如果没有，可以访问。如果过期了，需要重新走上面的流程生成新的token。可这个时候就不用在用户表里面添加新的用户了，因为用户已经存在了，可以生成新的key=》value对应关系，key=》代表新生成的token。</li></ol></li></ol><p>大致就这些了吧···</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;关于token。&lt;br&gt;故事背景：itbasic用vue做了个手机版，之前是用jquery识别是手机还是web实现页面上元素的尺寸变化，实现兼容，但是页面其实还是同一个。所以通过dom元素绑定的后台请求ajax，api接口可以通用。现在用了vue，这种mvvm模式的框架，需要后台返回纯json格式的数据，并不需要之前接口中可能返回的html，实现页面元素的变化，这样一来，很多接口得重写。之前的itbasic更像是远古时代的web，调用接口的基本权限控制用的是session里面存储的登录用户信息，而itbasic的web端更像是现代的web网站，调用接口不需要用户登录，而是通过令牌，也就是token进行身份认证。&lt;/p&gt;
    
    </summary>
    
      <category term="PHP" scheme="http://yoursite.com/categories/PHP/"/>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="token" scheme="http://yoursite.com/tags/token/"/>
    
      <category term="API" scheme="http://yoursite.com/tags/API/"/>
    
  </entry>
  
  <entry>
    <title>PHP文件操作</title>
    <link href="http://yoursite.com/2018/01/29/PHP%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/"/>
    <id>http://yoursite.com/2018/01/29/PHP文件操作/</id>
    <published>2018-01-29T08:04:01.000Z</published>
    <updated>2018-02-23T12:47:54.994Z</updated>
    
    <content type="html"><![CDATA[<p>上篇文章里面写了关于文件上传。其实在做文件上传的功能的时候遇到很多php关于文件的处理，记录下来。其实文件处理在我们刚开始学习php的时候肯定学习过，可后来因为项目当中，做网站的时候关于文件的操作很少，所以很容易忘记这部分的内容，毕竟其实也挺枯燥的。<br><a id="more"></a><br>1.遍历文件夹下的所有文件。<br>在做大文件切割的时候，本来想用php做，可是php的fopen好像最多只能接受8000多个字节，就是8000B，而我们上传文件大小一般能达到4m,如果按照8000B的切割也就太多小文件了，于是用linux新建个文件夹，在文件夹中split -b  4m 文件名 （还有个参数代表切割文件的名称，我没有仔细看，使用的默认的，就会产生xaa,xab···这种的文件），然后删除原始文件，遍历文件夹下的所有文件，每次上传一个，像服务器上刚开始创建好的文件持续写入，这样就能实现php的大文件上传<br>php:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">$dir = &apos;/root/test&apos;;</div><div class="line">$handle = opendir($dir);</div><div class="line">$fileArr = [];</div><div class="line">while($filename = readdir($handle)) &#123;</div><div class="line">     if ($filename != &apos;.&apos; &amp;&amp; $filename != &apos;..&apos; &amp;&amp; !is_dir($filename)) &#123;</div><div class="line">            array_push($fileArr, $filename);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">//var_dump($fileArr);exit;</div></pre></td></tr></table></figure></p><p>2.遍历文件夹下所有文件<br>这个是面试题中经常考得一道题</p><p>php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">function listDir($dir)</div><div class="line">&#123;</div><div class="line">if(is_dir($dir))</div><div class="line">   &#123;</div><div class="line">     if ($dh = opendir($dir)) </div><div class="line">&#123;</div><div class="line">        while (($file = readdir($dh)) !== false)</div><div class="line">&#123;</div><div class="line">     if((is_dir($dir.&quot;/&quot;.$file)) &amp;&amp; $file!=&quot;.&quot; &amp;&amp; $file!=&quot;..&quot;)</div><div class="line">&#123;</div><div class="line">     echo &quot;&lt;b&gt;&lt;font color=&apos;red&apos;&gt;文件名：&lt;/font&gt;&lt;/b&gt;&quot;,$file,&quot;&lt;br&gt;&lt;hr&gt;&quot;;</div><div class="line">     listDir($dir.&quot;/&quot;.$file.&quot;/&quot;);</div><div class="line">     &#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">         if($file!=&quot;.&quot; &amp;&amp; $file!=&quot;..&quot;)</div><div class="line">&#123;</div><div class="line">         echo $file.&quot;&lt;br&gt;&quot;;</div><div class="line">      &#125;</div><div class="line">     &#125;</div><div class="line">        &#125;</div><div class="line">        closedir($dh);</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line">//开始运行</div><div class="line">listDir(&quot;./nowamagic&quot;);</div></pre></td></tr></table></figure></p><p>上面两个场景大致差不多，主要就是几个函数的使用。首先要明确读取文件夹的内容和读取文件的内容是不一样的。</p><ol><li>is_dir 判断该文件是否是文件夹，注意的一点事一定要跟上文件名的前缀··，否则不能找到指定文件，会有奇怪的错误发生。</li><li>is_file 判断是否是文件</li><li>读取文件夹的内容，首先要打开文件夹,opendir() ,会产生一个资源型的数据类型，句柄，readdir() 会循环遍历文件夹的内容。closedir()读完文件之后关闭。</li><li>注意每个文件夹下的两个特殊文件’.’ 和 ‘..’</li></ol><p>3.php合并文件<br>思路：其实就是打开一个文件，不断往里面写入。关于打开fopen() 参数很多，感觉很多都是遇到的时候再看吧，二进制文件记得加b。<br>php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$fb = fopen(&apos;/root/1.css&apos;, &apos;wb&apos;);</div><div class="line">foreach ($fileArr as $key=&gt;$value) &#123;</div><div class="line">    fwrite($fb, file_get_contents(&apos;/root/test/&apos;.$value));</div><div class="line">&#125;</div><div class="line">fclose($fopen);</div></pre></td></tr></table></figure></p><p>每次的写入都是从尾部开始写入的。（相比较打开文件夹，他少了个readdir这种循环遍历文件夹的函数，好像fgets也有这种功能，但是用的不多，就没细看了）。</p><p>4.还有一些关于文件的函数，比如获取文件内容file_get_contents,写入file_put_contents,获取fgets这种的好像是按照行获取的，一般读操作用file_get_contents,能读取全部的内容。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;上篇文章里面写了关于文件上传。其实在做文件上传的功能的时候遇到很多php关于文件的处理，记录下来。其实文件处理在我们刚开始学习php的时候肯定学习过，可后来因为项目当中，做网站的时候关于文件的操作很少，所以很容易忘记这部分的内容，毕竟其实也挺枯燥的。&lt;br&gt;
    
    </summary>
    
      <category term="PHP" scheme="http://yoursite.com/categories/PHP/"/>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="文件操作" scheme="http://yoursite.com/tags/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/"/>
    
  </entry>
  
  <entry>
    <title>文件上传</title>
    <link href="http://yoursite.com/2018/01/26/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <id>http://yoursite.com/2018/01/26/文件上传/</id>
    <published>2018-01-26T10:26:03.000Z</published>
    <updated>2018-02-23T12:50:17.137Z</updated>
    
    <content type="html"><![CDATA[<p>今天遇到一个问题，关于大文件的上传。其实不管是大文件的上传，还是普通的文件上传，一直都是迷迷糊糊的，今天对其进行整理下。<br><a id="more"></a><br>首先，最基本的，文件大小单位</p><blockquote><p>1KB等于1024B，B是英文Byte(比特，字节)的缩写,KB即kilobyte,字面意思就是千比特。<br>byte是文件大小的一个计量单位，大家都知道在计算机里面，文件都是以二进制方式存储的，这样一个最小的存储单元（譬如10、11、01、00）叫做一个bit(位，位元)，八个位元等于一个比特。<br>转换关系：<br>8bit=1b<br>1024byte=1kb<br>1024kb=1mb<br>1024mb=1gb<br>1024gb=1tb<br>以上单位k指千、m指百万、g指10亿，t指万亿，大小写均可。<br>因为1024≈1000，所以1024b,也称为1k，以下类似。</p></blockquote><p>简单点说就是 1G =1024M  1M = 1024K  1K=1024B  B之后就是位了，8位是1B，一般都是B为计量单位。</p><p><a href="http://www.runoob.com/php/php-file-upload.html" target="_blank" rel="external">菜鸟教程这里面有对最基本的php文件上传的demo</a></p><p>html :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;html&gt;</div><div class="line">&lt;head&gt;</div><div class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</div><div class="line">&lt;title&gt;&lt;/title&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line"></div><div class="line">&lt;form action=&quot;upload_file.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</div><div class="line">    &lt;label for=&quot;file&quot;&gt;文件名：&lt;/label&gt;</div><div class="line">    &lt;input type=&quot;file&quot; name=&quot;file&quot; id=&quot;file&quot;&gt;&lt;br&gt;</div><div class="line">    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;提交&quot;&gt;</div><div class="line">&lt;/form&gt;</div><div class="line"></div><div class="line">&lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p><p>这个是以最基本的表单提交方式，当点击提交的时候文件就直接飞到upload_file.php那边了，注意接受的变量以表单控件的name字段的内容为变量名（$_POST[]）数组里面（想了下，其实框架的路由都是从这些大数组里面获取变量的信息）。<br>这个 <strong>enctype</strong> 很重要</p><blockquote><p><form> 标签的 enctype 属性规定了在提交表单时要使用哪种内容类型。在表单需要二进制数据时，比如文件内容，请使用 “multipart/form-data”。</form></p><p><input> 标签的 type=”file” 属性规定了应该把输入作为文件来处理。举例来说，当在浏览器中预览时，会看到输入框旁边有一个浏览按钮。</p></blockquote><p>不仅是这块，当用curl模拟文件上传的时候，也有相关的参数设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl_setopt($ch, CURLOPT_POSTFIELDS, $params);</div></pre></td></tr></table></figure></p><p>这个param如果是普通的post数据提交，要拼接成&amp;这种string方式，如果是文件上传，直接是传输组参数就可以了。</p><p>php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">// 允许上传的图片后缀</div><div class="line">$allowedExts = array(&quot;gif&quot;, &quot;jpeg&quot;, &quot;jpg&quot;, &quot;png&quot;);</div><div class="line">$temp = explode(&quot;.&quot;, $_FILES[&quot;file&quot;][&quot;name&quot;]);</div><div class="line">echo $_FILES[&quot;file&quot;][&quot;size&quot;];</div><div class="line">$extension = end($temp);     // 获取文件后缀名</div><div class="line">if ((($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/gif&quot;)</div><div class="line">|| ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/jpeg&quot;)</div><div class="line">|| ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/jpg&quot;)</div><div class="line">|| ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/pjpeg&quot;)</div><div class="line">|| ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/x-png&quot;)</div><div class="line">|| ($_FILES[&quot;file&quot;][&quot;type&quot;] == &quot;image/png&quot;))</div><div class="line">&amp;&amp; ($_FILES[&quot;file&quot;][&quot;size&quot;] &lt; 204800)   // 小于 200 kb</div><div class="line">&amp;&amp; in_array($extension, $allowedExts))</div><div class="line">&#123;</div><div class="line">    if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)</div><div class="line">    &#123;</div><div class="line">        echo &quot;错误：: &quot; . $_FILES[&quot;file&quot;][&quot;error&quot;] . &quot;&lt;br&gt;&quot;;</div><div class="line">    &#125;</div><div class="line">    else</div><div class="line">    &#123;</div><div class="line">        echo &quot;上传文件名: &quot; . $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot;&lt;br&gt;&quot;;</div><div class="line">        echo &quot;文件类型: &quot; . $_FILES[&quot;file&quot;][&quot;type&quot;] . &quot;&lt;br&gt;&quot;;</div><div class="line">        echo &quot;文件大小: &quot; . ($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024) . &quot; kB&lt;br&gt;&quot;;</div><div class="line">        echo &quot;文件临时存储的位置: &quot; . $_FILES[&quot;file&quot;][&quot;tmp_name&quot;] . &quot;&lt;br&gt;&quot;;</div><div class="line">        </div><div class="line">        // 判断当期目录下的 upload 目录是否存在该文件</div><div class="line">        // 如果没有 upload 目录，你需要创建它，upload 目录权限为 777</div><div class="line">        if (file_exists(&quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;]))</div><div class="line">        &#123;</div><div class="line">            echo $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot; 文件已经存在。 &quot;;</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">        &#123;</div><div class="line">            // 如果 upload 目录不存在该文件则将文件上传到 upload 目录下</div><div class="line">            move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], &quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;]);</div><div class="line">            echo &quot;文件存储在: &quot; . &quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">    echo &quot;非法的文件格式&quot;;</div><div class="line">&#125;</div><div class="line">?&gt;</div></pre></td></tr></table></figure><p>之前一直以为这是框架的内容，其实这是php自带的，框架可能只是对他的封装和安全性的校验。如果有时候实在上传出错，试试这个数组。</p><p>几个要注意的点：</p><ol><li>临时上传文件的地址可以通过phpinfo() 查看，但如果你真到那个文件夹下是找不到的，通过move_uploaded_file 函数移动到你需要的位置。因为我们itbasic之前的上传都写好了，导致我以为上传直接上传到指定的文件夹。</li><li>几个函数 is_dir  判断文件夹是否存在，file_exists,判断文件是否存在，<br>move_uploaded_file 移动文件。注意创建文件夹的时候给权限755.</li><li>移动到新的地址直接返回新的地址给前端就可以了。</li><li>注意一下我们平时比如itbasic上表单的提交都不是以form这种格式，都是直接通过按钮触发click事件，然后获取页面内容进行提交，这种方式是上传不了文件的，我们可以利用jq，<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var writeData = new FormData();</div><div class="line">writeData.append(&apos;object&apos;, objid);</div></pre></td></tr></table></figure></li></ol><p>然后往里面添加属性，通过append</p><ol><li>之前还上传过base64格式的image图片，其实这个要比前面的文件上传简单很多，这个与其说是上传文件，不如说是保存数据内容。</li></ol><p>一个image的base64格式码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data:image/png;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wgARCABPAFgDASIAAhEBAxEB/8QAGwAAAQUBAQAAAAAAAAAAAAAAAAECAwQGBQf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHbvbIA1B7alwUwuyLDRxUFCaSOQRHRmJ6VXHHe9DyusEUCqASyMeJRs8Y5uTu9cbqMohvlyGwKgoTRySGL6Wg55i2dBh3+15fuzpTNcVQCZ0MRaoTBbSqhJw+yFxtVB5EH/8QAKBAAAAYABQMFAQEAAAAAAAAAAAECAwQFEBEUMzQGFTESEyFBRCBC/9oACAEBAAEFAj3fH8fePkfpPd84LWTaGJceSP8AT96uPPZdJ9keAfJPdHnDtS4trY2KEtwH6yO6PGB8k93BaUrQ7W1iTr3o7L0O0hOPYnyT3c/nP5elRUBXY0nXSo8V3vyUCFNTNZzGfz+k90zIiN5pIk9rfVarhJBWrDUBjqLJtfUihAvCkvg+Se6+y3IaLpxn1opYSAiM5XSbGyjvxauDo4eWYJpslA+Se7g9OixidtZM0N9P5s+7YU7sCc3YM4HyT3QpJLSivhtgiyL7fYbktV1WqBIwPkuK9CikIIalA1KBqUDUpGpSNSgalA1CDCFe4/8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAQP/aAAgBAwEBPwF3/8QAFBEBAAAAAAAAAAAAAAAAAAAAQP/aAAgBAgEBPwF3/8QAMBAAAQMCBAQFAQkAAAAAAAAAAQACAxEhEBIxcQQTUXIiIzJBYYEFIDAzQ1JigpH/2gAIAQEABj8CGxV/wLIdqGxxc91mtFSvJla7498JI8jHxNNLapsoDgHDRwviO1DY40KjmicBBmqammX4XLg4mIF2r61y/wCJoDZJZT+o5ipiO1DY4lrtCjzJsu8qJ4qMPZTpW6EMMJiLtPAPuDtQ2xMU0sY6tcVfl/SpUjp4s4Itaq8ngrb0WcMcw1oQcRshsVcq8jB/ZVnfAXD+d1E3ggyouXNWRsodxGT1NjpdUnizO6t914OGA3chDNHkc7QjAbIbFGKVtWlXnfl6UQ8rN8ucpJZ+CE0R0Lbhv0Qi4WOmb1eGlFR35j7uVwFmEbQetMB2obHCi8yZoPStSuV9nwvp+9HnSnnG9RoFkcas9gbtKJAo4epvRUwHahsVZFrhY6rw8NH9RVUCojHK2rSpXczMxwoOuF0O1B3tRaFaOWjlo5aFaOWjlo5aFZh0X//EACcQAQACAAQFBAMBAAAAAAAAAAEAESFBUfAQMWFxkYGh0fEgweGx/9oACAEBAAE/Id21IZFjl+C4TUfweYWOccNrnNm1IgKYLaPmJTYJV0E5qvOj/jnLwHRmFOxydWPeXG0FARWwPMAFE23WbNqcEpTMNa9c5XJ7QoZ9UA2OCuHQtjGixVBL6F2S7sOOsClHDbdZs2pxNeypxqIIrL+mM5HlzG7IitqVF+Pw23WOu7/0lcGPiVwY+I03JQXJ1JfNvpvaYcaCGj6wFS72RKBZQs+8rdY+JXBj4ju9Zs2pLEAas90wErs/lT2MKvKi+Mc5ThUWBp5ka9jyejuuJ8hf+oChFPsXThtes2bUma45LBTfAAfP8lWG9Q+3KWdQogL5/wBS05eQgZYQgMU7eh6fMpYcSnC5DfDbdZs2pwu1HnSLAZl9gRhCWCzH0yINBX8wn7lUzok9NIqbDs+XaXSLzrw23WbNqRtwXd0l9w6GsUuzr+1AIADIJeHoYdz2nUlDdY1qz4FmC7Os23WXMLYNekAo8Z8z6A+Z9AfM+gPmYmX2J9MT6A+Z9AfMQU+MlICBTGf/2gAMAwEAAgADAAAAEMOMPOMFLGOPAJPGEJMFGDBNAELPBODP/8QAFBEBAAAAAAAAAAAAAAAAAAAAQP/aAAgBAwEBPxB3/8QAFBEBAAAAAAAAAAAAAAAAAAAAQP/aAAgBAgEBPxB3/8QAJhABAAEDAwMEAwEAAAAAAAAAAREAITFBUWFxgaEQkbHwINHhwf/aAAgBAQABPxASF94zS7DKmURIb812q21dqUKEKnWyfutXWrV2pWMCJRMDtzRhS4Z1u9NLgJJmos2Lg1/tN9k3QErBdsaUcxclABvOIdqWWcKPZP3RED2SaBkUYlppmj1GYExc7dyGoM2bq0/v3rGCCZrwHy9dJpgawLcRZbh7Ubx4KgBZCSETZvu6Wx2KwEqWNtyi5XAAnTXUheaS1gEIMf2jDAUV4D5fhplJMMrOpc6lR5ihK3ZMjrUlzpSgSMg3za1R/KYNmL2G2pFAGI7evgPlQSxZEgX2aRlJzGce8RSEpPGce8RUDB7UhqaI6lX/ANwB0JHtUAjlvNMkwKNE7oJOi/NXyMTQytCEvm3IUhbn1x7xFQCM1DOPeIpyd7HJy9FKAzykBRUj/YloGVIvo2U170QmDpjAHLU3nzRKRKp6B0WCUmL0sOQAE4YPSZ4i6CXrLn2B81JAwpTCG5w37Vonivv8vTSPg0KwiNkTCN5oLAWJTm8aXIdfxonhWu+0wUEMWgwjfc9x17AEGCrtoc0CuDF5RZdQeWk7OAYITpvQnBowdwmivAfL0070z8yFxSxllujmZO5Vq+JwbynurO0NEgmFkkszec3ZLlt2dwLKec57EdzdbzkgUzAdVDDbDQWDKWVCvAfL0UsUQzH0ZqVhLJsSHFRAMgKO4XzQQ2ggAUsMQKe0fuhzvccrRNHmjGJypZKdEmJMy2KSf8p2Wsx9Ga+xyqHmS0klWrxUNM9z8BAgQYcWTOSbRr1rL9Dv6kCD1MfpmgES45yu/Nf/2Q==</div></pre></td></tr></table></figure></p><p>图片在使用的时候只用image src=”” 等于上面这串内容就可以了。像wangeditor里面，写的内容，两种保存图片的方式：1.base64， 直接把这个image src = base64格式保存在html中 2.把文件上传到服务器上，然后获取链接地址。</p><p>base64 php处理代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">if (preg_match(&apos;/^(data:\s*image\/(\w+);base64,)/&apos;, $src, $result))&#123;</div><div class="line">                $type = $result[2];</div><div class="line">                $body = str_replace($result[1], &apos;&apos;, $src);</div><div class="line">                $filename = $path.date(&apos;YmdHis&apos;, time()).&apos;.&apos;.$type;</div><div class="line">                if (file_put_contents($filename, base64_decode($body)))&#123;</div><div class="line"></div><div class="line">                &#125;else&#123;</div><div class="line">                    return [&apos;code&apos;=&gt;CODE_ERROR, &apos;msg&apos;=&gt;&apos;文件保存失败&apos;];</div><div class="line">                &#125;</div><div class="line">            &#125;</div></pre></td></tr></table></figure></p><p>大致说下一下，type 获取的是正则 （\w+）里面内容，代表图片的格式，<br>body 获取的正则的内容，注意看表达式最外面的（）括号，result[0]代表的是完全匹配内容。</p><p>php获取到图片base64加密后的内容，通过解密，file_put_contents 写入文件，返回文件地址。</p><p>上面是通过前端 js + 后端php，实现的文件上传，其实完全可以通过 php + php 实现，下面分别介绍通过这两种方式实现的大文件上传。</p><p>客户端php代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env php</div><div class="line">&lt;?php</div><div class="line"></div><div class="line">const DATRIX_URL = &quot;http://211.144.114.26:19980&quot;;</div><div class="line">//const DATRIX_URL = &quot;http://192.168.50.229&quot;;</div><div class="line">const DATRIX_UID = &quot;itbasic&quot;;</div><div class="line">const DATRIX_PUID = &quot;itbasic&quot;;</div><div class="line">//const DATRIX_DATA_DIR = &quot;9bbd816d16ff589aee0ffe0ce68323ba&quot;;</div><div class="line">//const DATRIX_DATA_OBJ = &quot;20180126/09/9bbd816d16ff589aee0ffe0ce68323ba&quot;;</div><div class="line">const DATRIX_DATA_DIR = &quot;4bb4db1235077fb2ba6ea2b9a0220693&quot;;</div><div class="line">const DATRIX_DATA_OBJ = &quot;20180125/16/4bb4db1235077fb2ba6ea2b9a0220693&quot;;</div><div class="line">const DATRIX_EXECUTE_ID = &quot;itbasic&quot;;</div><div class="line">const DATRIX_CREATE_URI = &quot;/api/sw/file/create&quot;;</div><div class="line">const DATRIX_WRITE_URI = &quot;/api/sw/file/write&quot;;</div><div class="line">const DATRIX_FINISH_URI = &quot;/api/sw/file/finish&quot;;</div><div class="line"></div><div class="line">$filename = substr(date(&apos;Ymd&apos;), 2).&apos;.sql.tar&apos;;</div><div class="line">$trueFileName = &apos;/var/dataitbasic/&apos;.$filename;</div><div class="line"></div><div class="line">function http_post_data($url, $params = array(), $string = 1)</div><div class="line">&#123;</div><div class="line">    if (is_array($params) &amp;&amp; $string)</div><div class="line">    &#123;</div><div class="line">        $params = http_build_query($params, null, &apos;&amp;&apos;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $ch = curl_init();</div><div class="line">    curl_setopt($ch, CURLOPT_POST, 1);</div><div class="line">    curl_setopt($ch, CURLOPT_URL, $url);</div><div class="line">    curl_setopt($ch, CURLOPT_ENCODING, &quot;&quot;);</div><div class="line">    curl_setopt($ch, CURLOPT_POSTFIELDS, $params);</div><div class="line">    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</div><div class="line">    $response = curl_exec($ch);</div><div class="line">    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);</div><div class="line">    curl_close($ch);</div><div class="line"></div><div class="line">    return [$httpCode, json_decode($response,true)];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">$param = [</div><div class="line">    &apos;filename&apos;=&gt;$filename,</div><div class="line">    &apos;filesize&apos;=&gt;filesize($trueFileName),</div><div class="line">    &apos;createuid&apos;=&gt;DATRIX_UID,</div><div class="line">    &apos;parentuid&apos;=&gt;DATRIX_PUID,</div><div class="line">    &apos;dirid&apos;=&gt;DATRIX_DATA_DIR,</div><div class="line">    &apos;parentobj&apos;=&gt;DATRIX_DATA_OBJ,</div><div class="line">    &apos;city&apos;=&gt;&apos;上海&apos;,</div><div class="line">    &apos;district&apos;=&gt;&apos;&apos;,</div><div class="line">    &apos;gps&apos;=&gt;&apos;121.48789949,31.24916171&apos;,</div><div class="line">    &apos;isperdir&apos;=&gt;&apos;true&apos;,</div><div class="line">    &apos;userid&apos;=&gt;DATRIX_EXECUTE_ID,</div><div class="line">    &apos;debug&apos;=&gt;true</div><div class="line">];</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">function uploadToDatrix($createParam, $trueFileName)</div><div class="line">&#123;</div><div class="line">    $block = 4*1024*1024;</div><div class="line"></div><div class="line">    $create = http_post_data(DATRIX_URL.DATRIX_CREATE_URI, $createParam, 1);</div><div class="line"></div><div class="line">    $objid = $create[1][&apos;result&apos;][&apos;objid&apos;];</div><div class="line"></div><div class="line">    if ($create[1][&apos;code&apos;] == 200) &#123;</div><div class="line"></div><div class="line">        if (filesize($trueFileName) &gt; $block) &#123;</div><div class="line">            </div><div class="line"></div><div class="line">            $dir = DIR.substr(date(&apos;Ymd&apos;), 2);</div><div class="line">            $handle = opendir($dir);</div><div class="line">            $fileArr = [];</div><div class="line">            while(($filename = readdir($handle)) !== false) &#123;</div><div class="line">                if (!is_dir($filename) &amp;&amp; $filename != &apos;.&apos; &amp;&amp; $filename != &apos;..&apos;) &#123;</div><div class="line">                    array_push($fileArr, $filename);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            closedir($handle);</div><div class="line">            $offset = 0;</div><div class="line">            foreach ($fileArr as $key=&gt;$value) &#123;</div><div class="line"></div><div class="line">                $writeParam = [</div><div class="line">                    &apos;object&apos;=&gt;$objid,</div><div class="line">                    &apos;bucket&apos;=&gt;DATRIX_EXECUTE_ID,</div><div class="line">                    &apos;length&apos;=&gt;filesize($dir.&apos;/&apos;.$value),</div><div class="line">                    &apos;debug&apos;=&gt;true,</div><div class="line">                    &apos;filedata&apos;=&gt;file_get_contents($dir.&apos;/&apos;.$value),</div><div class="line">                    &apos;offset&apos;=&gt;$offset</div><div class="line">                ];</div><div class="line">                $writeResult = http_post_data(DATRIX_URL.DATRIX_WRITE_URI, $writeParam, 0);</div><div class="line"></div><div class="line">                $offset += filesize($dir.&apos;/&apos;.$value);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            $finshData = [</div><div class="line">                &apos;objectid&apos;=&gt;$objid,</div><div class="line">                &apos;createuid&apos;=&gt;DATRIX_UID,</div><div class="line">                &apos;userid&apos;=&gt;DATRIX_EXECUTE_ID,</div><div class="line">                &apos;fileid&apos;=&gt;$create[1][&apos;result&apos;][&apos;fileid&apos;],</div><div class="line">                &apos;debug&apos;=&gt;true</div><div class="line">            ];</div><div class="line"></div><div class="line">            if ($writeResult[1][&apos;code&apos;] == 200) &#123;</div><div class="line">                $finish = http_post_data(DATRIX_URL.DATRIX_FINISH_URI, $finshData,1);</div><div class="line">            &#125;</div><div class="line">            if ($finish[1][&apos;code&apos;] != 200) &#123;</div><div class="line">                echo date(&apos;Ymd&apos;);</div><div class="line">            &#125;</div><div class="line">        &#125; else &#123;</div><div class="line">            //$file = fopen($trueFileName, &apos;rb&apos;);</div><div class="line">            //$content = fread($file, filesize($trueFileName));</div><div class="line"></div><div class="line">            //$content = fgets($file);</div><div class="line"></div><div class="line">            $content = file_get_contents($trueFileName);</div><div class="line"></div><div class="line">            //echo &quot;filesize:&quot;.filesize($trueFileName);</div><div class="line"></div><div class="line">            $writeParam = [</div><div class="line">                &apos;object&apos;=&gt;$objid,</div><div class="line">                &apos;bucket&apos;=&gt;DATRIX_EXECUTE_ID,</div><div class="line">                &apos;length&apos;=&gt;filesize($trueFileName),</div><div class="line">                &apos;debug&apos;=&gt;true,</div><div class="line">                &apos;filedata&apos;=&gt;$content,</div><div class="line">                &apos;offset&apos;=&gt;0</div><div class="line">            ];</div><div class="line"></div><div class="line">            $writeResult = http_post_data(DATRIX_URL.DATRIX_WRITE_URI, $writeParam, 0);</div><div class="line"></div><div class="line">            $finshData = [</div><div class="line">                &apos;objectid&apos;=&gt;$objid,</div><div class="line">                &apos;createuid&apos;=&gt;DATRIX_UID,</div><div class="line">                &apos;userid&apos;=&gt;DATRIX_EXECUTE_ID,</div><div class="line">                &apos;fileid&apos;=&gt;$create[1][&apos;result&apos;][&apos;fileid&apos;],</div><div class="line">                &apos;debug&apos;=&gt;true</div><div class="line">            ];</div><div class="line"></div><div class="line">            if ($writeResult[1][&apos;code&apos;] == 200) &#123;</div><div class="line">                $finish = http_post_data(DATRIX_URL.DATRIX_FINISH_URI, $finshData,1);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if ($finish[1][&apos;code&apos;] != 200) &#123;</div><div class="line">                echo date(&apos;Ymd&apos;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">uploadToDatrix($param, $trueFileName);</div></pre></td></tr></table></figure><p>http_post_data 是通过curl封装的post方法，需要注意的点是，传的post参数不要组装成string（post三种传递数据方式，string， 表单还有一种），其实我们平时可以通过观察控制台，发现我们itbasic的每次提交都是post方式，但是数据组装方式，有string，表单两种类型。<br>还有注意我之前一直file以为传文件名就可以了，··坑爹啊··这样传服务端怎么获取内容，用file_get_contents()获取文件内容。<br>（今天偶然碰见，file_get_contents()不能获取itbasic.app这种本地定义的域名哦）。</p><ul><li style="list-style: none"><input type="checkbox"> php读取指定文件大小</li><li style="list-style: none"><input type="checkbox"> 完整的php接受大文件上传</li></ul><p>上传大文件  js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div></pre></td><td class="code"><pre><div class="line">var uploadToDatrix = function(fileObject, fileId, fileText, type, dirid, dirobj, pro, button) &#123; //参数是上传文件对象</div><div class="line">    if (button) &#123;</div><div class="line">        $(&apos;#&apos; + button).attr(&apos;disabled&apos;, &apos;disabled&apos;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    for (var i = 0; i&lt;fileObject.files.length; i++) &#123;</div><div class="line">        var file = fileObject.files[i]; //具体的文件</div><div class="line">        var filename = file.name;</div><div class="line">        var fileSize = file.size; console.log(file);</div><div class="line"></div><div class="line">        var data = &#123;</div><div class="line">            filename: filename,</div><div class="line">            filesize: fileSize,</div><div class="line">            createuid: DATRIX_UID,</div><div class="line">            parentuid: DATRIX_PUID,</div><div class="line">            dirid: dirid,</div><div class="line">            parentobj: dirobj,</div><div class="line">            city: &apos;上海市&apos;,</div><div class="line">            gps: &apos;121.48789949,31.24916171&apos;,</div><div class="line">            isperdir: true,</div><div class="line">            userid: DATRIX_EXECUTE_ID,</div><div class="line">            debug: &apos;true&apos;</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        $.ajax(&#123;</div><div class="line">            url: DATRIX_URL+DATRIX_CREATE_URI,</div><div class="line">            type: &quot;POST&quot;,</div><div class="line">            dataType: &quot;json&quot;,</div><div class="line">            data: data,</div><div class="line">            success: function (data) &#123;</div><div class="line">                var back = data.result;</div><div class="line">                console.log(back);</div><div class="line">                /* var writeData = &#123;</div><div class="line">                 object: back.objid,</div><div class="line">                 bucket: &quot;itbasic&quot;,</div><div class="line">                 length: fileSize,</div><div class="line">                 offset: 0,</div><div class="line">                 debug: true</div><div class="line">                 &#125;*/</div><div class="line">                fileWrite (fileSize, back.objid, fileSize, file, 0, back, fileId, fileText, type, button);</div><div class="line"></div><div class="line">            &#125;,</div><div class="line">            error : function(error) &#123;</div><div class="line">                showAlert(&apos;上传失败&apos;, &apos;danger&apos;);</div><div class="line">            &#125;</div><div class="line"></div><div class="line"></div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var fileWrite = function(uploadSize, objid, trueSize, file, start, back, fileId, fileText, type, button) &#123;</div><div class="line">    var writeData = new FormData();</div><div class="line"></div><div class="line">    if(uploadSize &lt;= 2 * 1024 * 1024) &#123;</div><div class="line">        var fileSize = uploadSize;</div><div class="line">    &#125; else &#123;</div><div class="line">        var fileSize = 2 * 1024 * 1024;</div><div class="line">    &#125;</div><div class="line">    var end = start * 1 + fileSize * 1;</div><div class="line">    var func = (file.mozSlice ? &apos;mozSlice&apos; : (file.webkitSlice ? &apos;webkitSlice&apos; : &apos;slice&apos;));</div><div class="line">    var uploadFile = file[func](start, end);</div><div class="line"></div><div class="line">    writeData.append(&apos;object&apos;, objid); //var writeData = new FormData();</div><div class="line">    writeData.append(&apos;bucket&apos;, &apos;itbasic&apos;);  //上传文件用户id</div><div class="line">    writeData.append(&apos;length&apos;, fileSize); //filesize,上传文件内容</div><div class="line">    writeData.append(&apos;offset&apos;,start); //文件开始点</div><div class="line">    writeData.append(&apos;debug&apos;, true);</div><div class="line">    writeData.append(&apos;file&apos;, uploadFile); //文件内容</div><div class="line"></div><div class="line">    console.log(start, fileSize, uploadSize);</div><div class="line"></div><div class="line">    $.ajax(&#123;</div><div class="line">        url: DATRIX_URL+DATRIX_WRITE_URI,</div><div class="line">        type: &quot;POST&quot;,</div><div class="line">        dataType: &quot;json&quot;,</div><div class="line">        data: writeData,</div><div class="line">        processData: false,</div><div class="line">        contentType: false,</div><div class="line">        async : false,</div><div class="line">        success : function(data) &#123;</div><div class="line">            //console.log(data);</div><div class="line">            uploadSize = uploadSize - fileSize;</div><div class="line">            console.log(uploadSize);</div><div class="line">            if (uploadSize*1 &gt; 0) &#123;</div><div class="line">                fileWrite(uploadSize, objid, trueSize, file, end, back, fileId, fileText, type, button);</div><div class="line">                return ;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            var finishData = &#123;</div><div class="line">                objectid:back.objid,</div><div class="line">                createuid:DATRIX_UID,</div><div class="line">                userid:DATRIX_EXECUTE_ID,</div><div class="line">                fileid:back.fileid,</div><div class="line">                debug:true</div><div class="line">            &#125;</div><div class="line">            $.ajax(&#123;</div><div class="line">                url: DATRIX_URL+DATRIX_FINISH_URI,</div><div class="line">                type: &quot;POST&quot;,</div><div class="line">                dataType: &quot;json&quot;,</div><div class="line">                data: finishData,</div><div class="line">                async : false,</div><div class="line">                success : function() &#123;</div><div class="line">                    $(&apos;#&apos;+button).removeAttr(&apos;disabled&apos;);</div><div class="line">                    if (pro == 1) &#123;</div><div class="line">                        var f = &#123;&apos;fname&apos;:back.filename,&apos;fid&apos;:back.fileid, &apos;objectid&apos;:back.objid&#125;;</div><div class="line">                        uploadContractFile.push(f); console.log(uploadContractFile);</div><div class="line"></div><div class="line">                    &#125; else &#123;</div><div class="line"></div><div class="line">                        if (fileId) &#123;</div><div class="line">                            var file_id = $(&apos;#&apos; + fileId).val();</div><div class="line">                            var upload_text = $(&apos;#&apos; + fileText).val() || &apos;&apos;;</div><div class="line">                            if (!file_id) &#123;</div><div class="line">                                file_id = back.fileid + &apos;,&apos; + back.filename;</div><div class="line">                                $(&apos;#&apos; + fileId).val(file_id);</div><div class="line">                            &#125; else &#123;</div><div class="line">                                file_id = file_id + &apos;,&apos; + back.fileid + &apos;,&apos; + back.filename;</div><div class="line">                                $(&apos;#&apos; + fileId).val(file_id);</div><div class="line">                            &#125;</div><div class="line"></div><div class="line">                            if (!upload_text) &#123;</div><div class="line">                                upload_text = back.filename;</div><div class="line">                                $(&apos;#&apos; + fileText).val(upload_text);</div><div class="line">                            &#125; else &#123;</div><div class="line">                                upload_text = upload_text + &apos; , &apos; + back.filename;</div><div class="line">                                $(&apos;#&apos; + fileText).val(upload_text);</div><div class="line">                            &#125;</div><div class="line">                        &#125; else &#123;</div><div class="line">                            var upload_text = $(fileText).find(&apos;.upload_text&apos;).val() || &apos;&apos;;</div><div class="line">                            var html = &apos;&lt;a href=&quot;javascript:;&quot; class=&quot;primary-link preview&quot; data-filename=&quot;&apos;+back.filename+&apos;&quot; data-fileid=&quot;&apos;+back.fileid+&apos;&quot; data-objid=&quot;&apos;+back.objid+&apos;&quot;&gt; &apos;+ back.filename +&apos; &lt;/a&gt;&apos;;</div><div class="line">                            $(fileText).find(&apos;.file_preview&apos;).append(html);</div><div class="line">                            if (!upload_text) &#123;</div><div class="line">                                upload_text = back.filename;</div><div class="line">                                $(fileText).find(&apos;.upload_text&apos;).val(upload_text);</div><div class="line">                            &#125; else &#123;</div><div class="line">                                upload_text = upload_text + &apos; , &apos; + back.filename;</div><div class="line">                                $(fileText).find(&apos;.upload_text&apos;).val(upload_text);</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line"></div><div class="line">                        Model.addupload(&#123;</div><div class="line">                            fileid: back.fileid,</div><div class="line">                            filename: back.filename,</div><div class="line">                            type: type,</div><div class="line">                            objectid: back.objid</div><div class="line">                        &#125;, function (res) &#123;</div><div class="line">                            if (res.code === CODE_SUCCESS) &#123;</div><div class="line"></div><div class="line">                            &#125; else if (res.code === CODE_ERROR) &#123;</div><div class="line">                                showAlert(res.msg, &apos;danger&apos;);</div><div class="line">                            &#125;</div><div class="line">                        &#125;)</div><div class="line">                    &#125;</div><div class="line">                &#125;,</div><div class="line">                error: function() &#123;</div><div class="line">                    showAlert(&apos;上传失败&apos;, &apos;danger&apos;);</div><div class="line">                &#125;</div><div class="line">            &#125;)</div><div class="line">        &#125;,</div><div class="line">        error : function() &#123;</div><div class="line">            showAlert(&apos;上传失败&apos;, &apos;danger&apos;);</div><div class="line">        &#125;</div><div class="line"></div><div class="line"></div><div class="line">    &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>没维护了，以后接着看吧。</p><p>php 文件处理，主要包括文件的分割和合并</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">function file_split($file,$block_size=  2 * 1024 * 1024)&#123;</div><div class="line">        $block_info=[];</div><div class="line">        $size=filesize($file);</div><div class="line">        $i=0;</div><div class="line">        while($size&gt;0)&#123;</div><div class="line">            $block_info[]= [</div><div class="line">                &apos;size&apos;=&gt;($size&gt;=$block_size?$block_size:$size),</div><div class="line">                &apos;file&apos;=&gt;$file.&apos;.&apos;.$i++</div><div class="line">            ];</div><div class="line">            $size-=$block_size;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        $fp = fopen($file,&quot;rb&quot;);</div><div class="line">        foreach ($block_info as $bi) &#123;</div><div class="line">            $handle = fopen($bi[&apos;file&apos;],&quot;wb&quot;);</div><div class="line">            fwrite($handle,fread($fp,$bi[&apos;size&apos;]));</div><div class="line">            fclose($handle);</div><div class="line">            unset($handle);</div><div class="line">        &#125;</div><div class="line">        fclose ($fp);</div><div class="line">        unset($fp);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function file_combine($file,$save_file=&apos;&apos;)&#123;</div><div class="line">        $filename=basename($file);</div><div class="line">        $filepath=dirname($file).&apos;/&apos;;</div><div class="line">        $block_info=array();</div><div class="line">        for($i=0;;$i++)&#123;</div><div class="line">            if(file_exists($file.&apos;.&apos;.$i) &amp;&amp; filesize($file.&apos;.&apos;.$i)&gt;0)&#123;</div><div class="line">                $block_info[]=$file.&apos;.&apos;.$i;</div><div class="line">            &#125;else&#123;</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        if($save_file)&#123;</div><div class="line">            $fp   = fopen($save_file,&quot;wb&quot;);</div><div class="line">        &#125;else&#123;</div><div class="line">            $fp   = fopen($file,&quot;wb&quot;);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        foreach ($block_info as $block_file) &#123;</div><div class="line">            $handle = fopen($block_file,&quot;rb&quot;);</div><div class="line">            fwrite($fp,fread($handle,filesize($block_file)));</div><div class="line">            fclose($handle);</div><div class="line">            unset($handle);</div><div class="line">        &#125;</div><div class="line">        fclose ($fp);</div><div class="line">        unset($fp);</div><div class="line">    &#125;</div></pre></td></tr></table></figure><p>php上传大文件有种就是先用php进行文件分割成小文件，然后小文件上传，然后上传到服务器上进行大文件合并。但有个问题就是php读取文件的fopen就8192字节，也就是8192B，一般上传文件都是4mb的上传，所以用的linux split分割文件后，放入文件夹里面，然后遍历文件夹，读取内容，写入操作的时候传入同一个objectid，往同一个文件里面写入</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天遇到一个问题，关于大文件的上传。其实不管是大文件的上传，还是普通的文件上传，一直都是迷迷糊糊的，今天对其进行整理下。&lt;br&gt;
    
    </summary>
    
      <category term="PHP" scheme="http://yoursite.com/categories/PHP/"/>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="文件上传" scheme="http://yoursite.com/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5 学习笔记</title>
    <link href="http://yoursite.com/2018/01/24/ThinkPHP5-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2018/01/24/ThinkPHP5-学习笔记/</id>
    <published>2018-01-24T05:52:42.000Z</published>
    <updated>2018-02-23T12:48:41.566Z</updated>
    
    <content type="html"><![CDATA[<p>关于TP5框架的学习。之所以写这个，是因为平时公司里面不用tp，工作快一年了，最深的印象就是不用的东西忘记很快，即使是你以前很熟练的东西，更别说以前就没有太懂的东西了，仿佛从来没了解过一样。<br><a id="more"></a><br>自己对于一个框架的学习体验：</p><p>关于面向对象。</p><ol><li>学习tp和我们公司的框架最大的比较就是，面向对象。在tp中使用别的类，不管是new class,还是class::function这种静态方法的调用，都得引入命名空间， use app\controller 这种，app对应tp的application目录。</li><li>think对应 think\下面内容，注意使用的时候要用到把类的名字也加上use xx,但是定义的时候 namespace 只是到文件夹，这个虽然很常识，但对于面向对象的新手来说还是很容易忽视的。</li><li>还有如果不引入命名空间的话，直接使用的话还需要在，use 后面的那个命名空间前面加 \。</li><li>tp有个Exception , php自身也有个Exception，在使用tp的exception的时候，注意一定要引入think 的exception 类，如果想要使用自身的exception，注意，\Exception, 否则会出错的。</li><li>老师的教程中，controller里面的banner类，名字是banner,model里面的banner类也是banner,，这样在引入banner的时候虽然好区分，但是使用的时候比如实例化的时候都是  new Banner,这样去分不开来，可以在引入的时候 使用 as进行重命名。</li></ol><p>关于属性访问权限<br>还记得当初学java面向对象的时候最开始部分吗，所哟的属性都定义成protected，不能被外部访问，但有个统一的方法能调用，获取属性值，这个在tp中也遇到好几次，属性不能访问，但有方法可以调用，获取这个属性值。</p><ol><li>入口文件。<br>像我们itbasic的host里面的router文件，tp public里面的index文件，只是tp里面把路由单独分离出去了，在应用application下面的router.php。这个文件是web server的访问入口文件。一般像apache里面的虚拟域名的配置（像router.php这种不是index开头的，还要作更多的rewrite规则的配置），nginx因为用fpm进行管理，所以还会location ~.php 之类的做更多的配置。</li><li>router<br>路由文件。作为一个初学者，现在还不用知道router里面是怎么写的，怎么具体工作的，我们要学会的是怎么使用它，怎么让他根据url请求路径找到特定的控制器。比如我们itbasic的klein ,<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$response-&gt;header(&apos;Access-Control-Allow-Origin&apos;, &apos;*&apos;);</div></pre></td></tr></table></figure></li></ol><p>对返回的信息头部进行配置，可以跨域访问。这个$response变量是什么东西呢，是klein对于请求的接口的回调函数里面传入的参数，有request和response，属于依赖注入的内容。<br>tp里面关于route:<br>默认是pathinfo模式<br>域名=&gt;根目录  入口文件=&gt;index.php  模块 index 控制器 index 方法 index 这种，很多时候这种pathinfo模式是不被nginx是别的，可以使用兼容模式，但现在兼容模式使用的也很少了，在这个restful api 的时代，所以大部分时候都是我们自己定义。<br>需要注意的点：<br>1.默认url是大小写不区分的，所以方法名里面的驼峰法，第二个大写字母和前一个单词之间应该用_连接。（这个修改url的大小写可以在conf.php里面修改）。<br>2.conf.php里面有两个参数url_route_on  url_route_must 两个参数和route的开启有关，用默认的就可以了，在router.php进行配置就能通过这种方式访问控制器了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Route::rule(&apos;hello&apos;， &apos;index/index/hello&apos;, &apos;post|get&apos;, [&apos;https&apos;=&gt;true])</div><div class="line">Route::get(&apos;banner/[:id]&apos;, &apos;index/v1.index/banner)</div></pre></td></tr></table></figure></p><p>其实重写route还有别的方式，只是这种方式比较简单。<br>引入think 的route 类，静态方法get是rule，访问类型是get方式的简写，[:id], 代表id可以有也可以没有， id是后面可以访问到的变量的名称，这个里面还可以对访问url进行更多的限制，比如http请求，具体的可以参考手册。<br>3.获取变量<br>1.最简单的获取变量的方式就是在函数的参数（）里面写上参数名称，比如$id,$name,函数会根据参数名称获取传过来的参数，注意这块是参数名称，并不是参数的顺序，像我们平时调用函数的时候，定义的函数，参数只是语义化，根据顺序来确定传入的参数是哪个对应哪个，我们要区分开。<br>2.通过think的request类，实例化，调用静态方法::instance,-&gt;get()···获取对应的参数，注意这块get不能获取到[:id] 这个id参数的值，这个id需要rule() 这个方法，还有如果[:id], 后面 ？id = 也定义了id，这样的话，前面的id不会被后面覆盖。<br>3.依赖注入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public function get(Request $req) &#123;</div><div class="line">    $req-&gt;param</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>这个param方法上面那个也可以使用。param获取任意方式传递过来的变量，params获取所有传入变量，放到一个数组里面<br>4.助手函数，input(‘get.’) 获取get方式传过来的所有变量，点号后面跟着参数名，可以获取对应的参数</p><p>推荐依赖注入吧。</p><ol><li>参数验证<br>tp有个validate类，是专门用来验证参数的，老师的课程里面专门把拿出来，作为和c m 同一级别的验证层，我感觉没有太大必要，其实tp自带的验证已经够用了，他只是在原有的基础上把check验证方法整合进去了，然后定义了更多自己的校验方法。如果按照他的关联，同一个验证器类的名字只是体现了一种变量的验证规则，但是rule里面却是传入了多个变量，感觉也不合理。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">class baseValidate extends validate &#123;</div><div class="line">    protected $rule = [</div><div class="line">        &apos;id&apos;=&gt;&apos;must | max 1&apos;,</div><div class="line">        &apos;num&apos;=&gt;&apos;in: 1,2,3 | idMustInt&apos;</div><div class="line">    ];  //这里面可以定义传入的参数</div><div class="line"></div><div class="line">  //自定义验证规则</div><div class="line">  public function idMustInt($id)&#123;</div><div class="line">      if (is_int($id) &amp;&amp; ($id*1+0)&gt;0) &#123;</div><div class="line">            return true;</div><div class="line">      &#125; else &#123;</div><div class="line">          return &apos;id 必须是整数&apos;;  </div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"> //自定义验证方法</div><div class="line">public function goCheck(Request $req)&#123;</div><div class="line">  //接收参数</div><div class="line"> $params = $req-&gt;params();</div><div class="line"> if ($this-&gt;batch()-&gt;check($prams)) &#123;</div><div class="line">   &#125; else &#123;</div><div class="line">    throw new paramsErrorException(</div><div class="line">    [&apos;errorMsg&apos;=&gt;$this-&gt;error]</div><div class="line">);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ol><p>因为这种参数验证错误，都应该归到http 400 errorCode 也是统一的，唯一不同的errorMsg, 验证错误的返回信息可以通过validate的error属性来获取。</p><ol><li>Exception<br>半吊子入门的编程人员，这一年的工作其实代码也不规范，刚开始看的别人的代码也不规范，加上天生不聪明，后天不努力，导致现在的代码也不规范。很少用到Exception。<br>异常处理，是php中原生就有，一般在连接数据库的时候使用。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">try &#123;</div><div class="line">    可能出现异常的代码</div><div class="line">&#125; catch （Exception $e）&#123; </div><div class="line">  处理方法</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>其中$e 也会有一些可以使用的方法，比如errorMsg,不太记得了，不同的扩展里面可能有不同，比如pdo里面有PDOException, phpmailer里面有他自己定义的mailer Exception。（这个exception是类名称哦，所以首字母要大写）<br>tp5的exception很强大，可以捕获所有程序中运行的错误，并抛出异常。<br>如果是我们平时，我们必须要在try {} 代码块中出现错误，才会抛出异常，然后捕获处理。<br>tp5中如果我们出现了错误，会直接在错误页面出现什么Exception之类的，之前还是很好奇为啥每次出错之后和我们项目中不一样，这其实是tp5的异常机制产生的。<br>对于try catch 捕获的异常，我们可以在catch（） 参数里面定义异常类型，或者是在catch 代码块里面重新再抛出异常或者直接写上异常的处理方法。<br>和前面的验证一样，我们面向切面编程，把validate 异常处理这种可以统一进行处理的方法封装起来。这样就不用再每个接口中写参数验证和异常处理，这样就能让接口显得很简单。<br>比如验证<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$validate = new BaseValidate(&apos;</div><div class="line">        [</div><div class="line">            &apos;id&apos;=&gt;&apos;require|idMustInt&apos;</div><div class="line">        ]</div><div class="line">&apos;)</div><div class="line">$validate-&gt;goCheck();</div></pre></td></tr></table></figure></p><p>所有的细节都封装到了验证层的内部；</p><p>相比较于验证，不同的验证返回的参数应该不一样，so，我们得定义不同的exception<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">public ParamErrorException extends Exception($param)&#123;</div><div class="line">        public $http = 400;</div><div class="line">        public $errorCode = 100000;</div><div class="line">        public $errMsg = &apos;参数错误&apos;;</div><div class="line">        public function __construct($param)&#123;</div><div class="line">              if (!is_array($data)) &#123;</div><div class="line">            return ;</div><div class="line">        &#125;</div><div class="line">        if (array_key_exists(&apos;httpCode&apos;, $data)) &#123;</div><div class="line">            $this-&gt;httpCode = $data[&apos;httpCode&apos;];</div><div class="line">        &#125;</div><div class="line">        if (array_key_exists(&apos;errCode&apos;, $data)) &#123;</div><div class="line">            $this-&gt;httpCode = $data[&apos;errCode&apos;];</div><div class="line">        &#125;</div><div class="line">        if (array_key_exists(&apos;errMsg&apos;, $data))&#123;</div><div class="line">        $this-&gt;errMsg = $data[&apos;errMsg&apos;];</div><div class="line">        &#125;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><p>这个初始化方法是为了某些不像传入很多参数的时候使用的。</p><p>话说之前总想着函数时候能以数组作为参数···有时候还加双引号，真的笨。</p><p>接下来是统一的处理方法。<br>首先在conf.php里面要配置<br>exception_handle  里面写上异常处理类的位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">class ExampleHandle extends Handle</div><div class="line">&#123;</div><div class="line">    private $httpCode;</div><div class="line">    private $errCode;</div><div class="line">    private $errMsg;</div><div class="line">    public function render(Exception $e)</div><div class="line">    &#123;</div><div class="line">        if ($e instanceof BasicEception) &#123;</div><div class="line">            $this-&gt;httpCode = $e-&gt;httpCode;</div><div class="line">            $this-&gt;errCode = $e-&gt;errCode;</div><div class="line">            $this-&gt;errMsg = $e-&gt;errMsg;</div><div class="line">        &#125; else &#123;</div><div class="line">            if (config(&apos;app_debug&apos;) == &apos;false&apos;) &#123;</div><div class="line">                return parent::render($e);</div><div class="line">            &#125; else &#123;</div><div class="line">                $this-&gt;httpCode = 500;</div><div class="line">                $this-&gt;errCode = 999;</div><div class="line">                $this-&gt;errMsg = &apos;服务器内部错误不想告诉你&apos;;</div><div class="line">                $this-&gt;recordLog($e-&gt;getMessage()); //服务器错误信息记录了日志</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">            return json([&apos;errCode&apos; =&gt; $this-&gt;errCode, &apos;errMsg&apos; =&gt; $this-&gt;errMsg, &apos;request_url&apos; =&gt; Request::instance()-&gt;url()], $this-&gt;httpCode);</div><div class="line">    &#125;</div><div class="line">    public function recordLog($content)</div><div class="line">    &#123;</div><div class="line">        Log::init([ &apos;type&apos;  =&gt; &apos;file&apos;,</div><div class="line">            // 日志保存目录</div><div class="line">            &apos;path&apos;  =&gt; LOG_PATH,</div><div class="line">            // 日志记录级别</div><div class="line">            &apos;level&apos; =&gt; [&apos;error&apos;],]);</div><div class="line">        Log::record($content, &apos;error&apos;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><ol><li>首先是自定义的异常，不用记录日志</li><li>服务器抛出的异常，线下环境，直接调用parent::render($e), render方法是异常处理类对类的处理<br>3.线上环境，返回json数据，记录日志。</li></ol><p>conf.php 开启了自动记录日志，把日志那块的type 从file改成test，···就能不记录日志。log_path 重新再入口文件出定义就能使用自己的了，level代表日志级别。<br>记得之前的日志记录功能因为关闭了，所以新的日志记录使用的时候要开始初始化。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;关于TP5框架的学习。之所以写这个，是因为平时公司里面不用tp，工作快一年了，最深的印象就是不用的东西忘记很快，即使是你以前很熟练的东西，更别说以前就没有太懂的东西了，仿佛从来没了解过一样。&lt;br&gt;
    
    </summary>
    
      <category term="PHP" scheme="http://yoursite.com/categories/PHP/"/>
    
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="框架" scheme="http://yoursite.com/tags/%E6%A1%86%E6%9E%B6/"/>
    
      <category term="ThinkPHP5" scheme="http://yoursite.com/tags/ThinkPHP5/"/>
    
  </entry>
  
  <entry>
    <title>PHPStorm开启断点调试</title>
    <link href="http://yoursite.com/2018/01/22/PHPStorm%E5%BC%80%E5%90%AF%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95/"/>
    <id>http://yoursite.com/2018/01/22/PHPStorm开启断点调试/</id>
    <published>2018-01-22T05:05:02.000Z</published>
    <updated>2018-03-30T03:10:14.706Z</updated>
    
    <content type="html"><![CDATA[<p>关于xdebug。作为一个phper，相信大家平时的调试用的都是var_dump,echo之类的，像我之前不知道var_dump可以打印出多个变量，在写代码的时候，经常为了打印多个变量，要写很多var_dump,后来无意间解除了xdebug，虽然现在还是经常用var_dump,但我感觉这类的辅助工具都是为了更好的，更高效率的完成工作，得变通，什么方便，什么自己用的舒服就用什么。平时的我感觉xdebug对于框架的学习，和自己平时不熟悉的代码的时候用的方便，var_dump,我一般用来进行简单的调试。<br><a id="more"></a><br>1.原理<br>没去看了</p><p>2.安装<br>首先得安装xdebug的php扩展。这个xdebug的安装真的方便，他的网站上对xdbug的安装简直是傻瓜式，百度他的网站，<a href="http://xdebug.org/wizard.php" target="_blank" rel="external">http://xdebug.org/wizard.php</a>，把你的pathinfo() 的内容粘贴过去，她能自动帮你选择扩展版本，其实window下要的就是之前文章里面提的四个版本，以及php的扩展存放路径，已经php.ini, linux下好文件，同之前的文章一下。安装完成之后pathinfo，查找xdebug。<br>这里注意下我们通过xampp这类软件安装的lamp其实不是lamp，这个l linux根本不存在，我们用的是w，windows。</p><p>具体的版本选择可以看这篇文章 帮<a href="http://blog.csdn.net/hel12he/article/details/44425781" target="_blank" rel="external">xdebug选择合适的安装版本</a></p><p>3.phpstorm的配置<br>之前的配置在网上找吧，因为懒得截图了<br><a href="https://www.jianshu.com/p/74a1d60ab5ef" target="_blank" rel="external">简书上的这篇文章对安装方法写的很详细</a></p><p>4.注意事项</p><ol><li>首先是关于断点的位置。代码会在断点之前结束，所以如果想要获取断点处的内容，务必在该内容之后打上断点。记得老师在将课程的时候甚至在这个方法结束处的 } 打了断点。</li><li>之前遇到的一个问题就是多个断点，只是执行了其中的几个断点，并没有执行完所有的断点，以为是使用的方法不对。后来发现其实是两个断点之间的代码又bug，导致后面的端点没有执行，··所以其实还是自身的问题。</li><li>断点调试的时候，所以的端点前面会有 √ 的标志，断点执行的那行代码会有颜色加深的标志。断点执行完，所有的 √ 的标志会没有。只要断点执行完了，接口才会有输出，并不是执行到哪个断点，哪个端点前面会有 √的标志。</li><li>代码可以一行一行的执行，也可以从这个断点直接跳转到下个断点，这样的好处是，对于复杂的框架可以知道代码是怎么执行的，然后断点间的跳转也可以迅速定位解决问题。但好像不同php文件断点间跳转，只有一个页面那个地方会对变量有输出。</li><li>变量的输出在下面那个debug tab标签处，开启断点调试，会在页面的url路径后面有xdebug_session 标志，把这个标志粘贴到不同的url，就能对不同的api进行测试，其实感觉这个就像一个接口一样，只要传递这个参数，就能执行这个debug接口的服务功能。</li><li>断点调试的关闭，··关闭那个phpstrom上方的类似电话的监听按钮肯定能关闭的，现在想了下，关闭下方tab肯定也是可以的，记得我每次close tab 他都会提醒是否close connect，断点调试的开始按钮是phpstorm的那个小瓢虫的标志。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;关于xdebug。作为一个phper，相信大家平时的调试用的都是var_dump,echo之类的，像我之前不知道var_dump可以打印出多个变量，在写代码的时候，经常为了打印多个变量，要写很多var_dump,后来无意间解除了xdebug，虽然现在还是经常用var_dump,但我感觉这类的辅助工具都是为了更好的，更高效率的完成工作，得变通，什么方便，什么自己用的舒服就用什么。平时的我感觉xdebug对于框架的学习，和自己平时不熟悉的代码的时候用的方便，var_dump,我一般用来进行简单的调试。&lt;br&gt;
    
    </summary>
    
      <category term="PHP" scheme="http://yoursite.com/categories/PHP/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="工具" scheme="http://yoursite.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="调试" scheme="http://yoursite.com/tags/%E8%B0%83%E8%AF%95/"/>
    
      <category term="Xdebug" scheme="http://yoursite.com/tags/Xdebug/"/>
    
  </entry>
  
  <entry>
    <title>lamp 源码编译</title>
    <link href="http://yoursite.com/2018/01/19/lamp-%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/"/>
    <id>http://yoursite.com/2018/01/19/lamp-源码编译/</id>
    <published>2018-01-19T07:21:41.000Z</published>
    <updated>2018-02-23T12:44:47.922Z</updated>
    
    <content type="html"><![CDATA[<p>lamp的源码编译安装。！！！注意哦，这里面是lamp，不是lnmp。之前的lamp中，apache和php的交流主要是apache把php作为自身的一个模块，而ngixn是通过cgi，php-fpm进行管理进程。所以lamp的编译安装是有顺序的，因为php在编译的过程中需要指定apache的apxs模块位置。<br><a id="more"></a></p><ol><li>apahce 的编译安装<br>apache2.4之后编译安装之前需要apr和apr-util的支持（这两个文件下载位置，百度，好像在apr.apache.org下面）apache在httpd.apache.org下面下载。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost src]#pwd</div><div class="line">/usr/local/src</div><div class="line">[root@localhost src]#tar xvf apr-1.6.2.tar.gz </div><div class="line">[root@localhost src]#tar xvf apr-util-1.6.0.tar.gz </div><div class="line">[root@localhost src]#tar xvf httpd-2.4.27.tar.bz2</div></pre></td></tr></table></figure></li></ol><p>编译安装 :<br>   1.进入解压目录，./configure 配置路径，百度吧 （–prefix==/usr/local/apr）<br>   2.make<br>   3.make install<br>   4.查看<br>安装apr-util之前得先安装apr</p><ol><li><p>安装额外的包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost src]#yum install openssl-devel expat-devel pcre-devel</div></pre></td></tr></table></figure></li><li><p>编译httpd</p></li></ol><p>参考文章：<a href="http://blog.csdn.net/leshami/article/details/50144179" target="_blank" rel="external">centos7 源码编译httpd7</a><br>其实这一块都不用lamp中安装apache和单独安转apache没啥区别。</p><p>而且后来发现一个问题 apachectl start 这些用不了</p><p>httpd -k start 这戏好用</p><p>其实ps -efl|grep httpd ,也能看到这个httpd 的命令</p><p>mysql 编译安装<br>失败，用的yum安装（直接下载编译好的二进制码比较好，比如subline下载之后直接就能使用，不用安装，这些java写的东西啊，好用，但是mysql不行，即使是编译过的二进制码，还要执行一些脚本）</p><p>php编译安装</p><ol><li>php.net 上下载源文件</li><li>安装额外的包<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install libxml2-devel bzip2-devel libmcrypt-devel</div></pre></td></tr></table></figure></li></ol><p>3.编译安装php7<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[root@localhost php-7.1.10]#./configure \</div><div class="line">&gt; --prefix=/app/php \</div><div class="line">&gt; --enable-mysqlnd \</div><div class="line">&gt; --with-mysqli=mysqlnd \</div><div class="line">&gt; --with-openssl \</div><div class="line">&gt; --with-pdo-mysql=mysqlnd \</div><div class="line">&gt; --enable-mbstring \</div><div class="line">&gt; --with-freetype-dir \</div><div class="line">&gt; --with-jpeg-dir \</div><div class="line">&gt; --with-png-dir \</div><div class="line">&gt; --with-zlib \</div><div class="line">&gt; --with-libxml-dir=/usr \</div><div class="line">&gt; --enable-xml \</div><div class="line">&gt; --enable-sockets \</div><div class="line">&gt; --with-apxs2=/app/httpd24/bin/apxs \</div><div class="line">&gt; --with-mcrypt \</div><div class="line">&gt; --with-config-file-path=/etc \</div><div class="line">&gt; --with-config-file-scan-dir=/etc/php.d \</div><div class="line">&gt; --enable-maintainer-zts \</div><div class="line">&gt; --disable-fileinfo</div><div class="line"></div><div class="line"></div><div class="line"># 进行编译安装</div><div class="line">[root@localhost php-7.1.10]#make -j 2 &amp;&amp; make install</div></pre></td></tr></table></figure></p><p>注意那个with-apxs2 的选项<br>下面那个 make -j 2 指的是用两个cpu进行编译</p><p>注意这时候时没有配置文件的，到解压的php文件夹下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost php-7.1.10]#cp php.ini-production /etc/php.ini</div></pre></td></tr></table></figure></p><p>编译php7的时候with-config-file-path 指定了配置文件的位置</p><ol><li>这时候在apache的根目录下访问phpinfo这种文件还是不幸的，需要支持对php的mime类型解析，修改httpd的配置文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AddType application/x-httpd-php .php</div></pre></td></tr></table></figure></li></ol><p>5.测试phpinfo</p><p>6.测试数据库连接</p><p>之前测试测试数据库总的出错···总结了下原因</p><ol><li>不能清楚的认识到mysql怎么连接数据库的。其实换一种思路，php是怎么连接redis的，我们安装好redis服务，然后安装php的redis扩展，就可以了。什么连接函数啊和连接mysql是一样的。关于php连接mysql，现在主推两种方式，mysqli和pdo，分别对应两种扩展，具体的可以参考<a href="http://www.runoob.com/php/php-mysql-connect.html" target="_blank" rel="external">菜鸟教程里面的这个php连接mysql</a>。</li><li>mysqli() 第一个参数’localhost’ 和’127.0.0.1’ 的区别，localhost 连接基于socket，这个文件的位置在php.ini有指定，如果换了位置，则找不到。127.0.0.1基于tcp，就可以啦，不用那个文件，参考链接<a href="https://segmentfault.com/q/1010000000328531" target="_blank" rel="external">segmentfault</a><br>mysql 这个status挺好用的哈哈<img src="http://ozys8fka7.bkt.clouddn.com/mysql-status.jpg" alt=""></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;lamp的源码编译安装。！！！注意哦，这里面是lamp，不是lnmp。之前的lamp中，apache和php的交流主要是apache把php作为自身的一个模块，而ngixn是通过cgi，php-fpm进行管理进程。所以lamp的编译安装是有顺序的，因为php在编译的过程中需要指定apache的apxs模块位置。&lt;br&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="环境" scheme="http://yoursite.com/tags/%E7%8E%AF%E5%A2%83/"/>
    
      <category term="lamp" scheme="http://yoursite.com/tags/lamp/"/>
    
  </entry>
  
  <entry>
    <title>lnmp yum安装</title>
    <link href="http://yoursite.com/2018/01/19/lnmp-yum%E5%AE%89%E8%A3%85/"/>
    <id>http://yoursite.com/2018/01/19/lnmp-yum安装/</id>
    <published>2018-01-19T07:21:24.000Z</published>
    <updated>2018-02-23T12:46:31.141Z</updated>
    
    <content type="html"><![CDATA[<p>关于lnmp环境的yum安装。作为一个phper，肯定得熟悉。之前写过关于在windows下php环境的搭建··咳咳咳，其实那根本算是搭建，像xampp都是把环境搭配好了，自己只是做了配置虚拟主机，然后运行框架。<br>框架在我的理解中本身除了yaf之类的安装，主流的框架tp，yii，laravel更像是一个文件夹，代码的集合体，这个文件夹中各个子文件夹联系紧密，成为一个整体。当外来请求通过lamp进入到入口文件，路由进入到控制器，模型层，数据库，变成一个有用的数据返回出来，再通过lamp返回给浏览器，上面的流程就很容易发现，简单的像apache,nginx里面的配置文件定义，只是让外来请求找到这个入口文件，进入到入口文件里面之后就靠框架的路由寻找具体的控制器了。<br>lamp环境方便的让外来请求比如对于index.php的请求，如果是直接在linux中，我么需要php (编译器) 可能还需要 -c指定配置文件的位置 文件.php,这样。但是如果是lamp，我们可以通过浏览器直接访问这个php文件。<br><a id="more"></a></p><ol><li>首先是yum源的安装，更新。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</div><div class="line">[root@localhost ~]# rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</div><div class="line">[root@localhost ~]# rpm -Uvh  http://dev.mysql.com/get/mysql57-community-release-el7-9.noarch.rpm</div></pre></td></tr></table></figure><p>先说这个mysql yum安装，现在要通过这个社区版。</p><p>然后剩下两个是为了安装第三方软件用的。这个epel以后可能经常用到，虽然没lamp好像只要这个webtatic就可以了。之前添加源的时候看过一篇文章，好像是说最好不要和官方源里面有内容冲突。这个epel很合适，大家都在用，当然自己也就用咯。</p><ol><li>yum安装nginx，mysql，php<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# yum -y install nginx</div><div class="line">[root@localhost ~]# yum -y install mysql-community-server</div><div class="line">[root@localhost ~]# yum -y install php70w-devel php70w.x86_64 php70w-cli.x86_64 php70w-common.x86_64 php70w-gd.x86_64 php70w-ldap.x86_64 php70w-mbstring.x86_64 php70w-mcrypt.x86_64  php70w-pdo.x86_64   php70w-mysqlnd  php70w-fpm php70w-opcache php70w-pecl-redis php70w-pecl-mongo</div></pre></td></tr></table></figure></li></ol><p>其实这里面比如php7安装的那几个我也不懂，据说把70w改成71w就能装7.1版本了。</p><p>3.yum安装的一个好处是通过systemctl enable 能控制软件的开机启动 关闭，通过systemctl status 能看软件的状态，启动，关闭。默认安装的mysql没有密码，可以直接登录进去。据说要配置默认编码，utf8，但我好像没有配置，它自动就是utf8。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]# vim /etc/my.cnf</div><div class="line">[mysqld]</div><div class="line">character_set_server=utf8</div><div class="line">init_connect=&apos;SET NAMES utf8&apos;</div><div class="line">[root@localhost ~]# systemctl restart mysqld    # 重启 MySQL</div></pre></td></tr></table></figure></p><ol><li>nginx的配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">location / &#123;</div><div class="line">    #定义首页索引文件的名称</div><div class="line">    index index.php index.html index.htm;   </div><div class="line">&#125;</div><div class="line"></div><div class="line"># PHP 脚本请求全部转发到 FastCGI处理. 使用FastCGI默认配置.</div><div class="line">location ~ .php$ &#123;</div><div class="line">    fastcgi_pass 127.0.0.1:9000;</div><div class="line">    fastcgi_index index.php;</div><div class="line">    fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</div><div class="line">    include fastcgi_params;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ol><p>注意这块document root的位置，要卸载location外面，我之前写在上面那个location里面，下面那个location获取不到。</p><p>重启nginx，重启php-fpm.</p><ol><li>测试是否成功。<br>在nginx根目录下 &lt;?php echo phpinfo();die;</li></ol><p>看能不能输出php信息咯。其实还可以检测下和mysql的连接。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;关于lnmp环境的yum安装。作为一个phper，肯定得熟悉。之前写过关于在windows下php环境的搭建··咳咳咳，其实那根本算是搭建，像xampp都是把环境搭配好了，自己只是做了配置虚拟主机，然后运行框架。&lt;br&gt;框架在我的理解中本身除了yaf之类的安装，主流的框架tp，yii，laravel更像是一个文件夹，代码的集合体，这个文件夹中各个子文件夹联系紧密，成为一个整体。当外来请求通过lamp进入到入口文件，路由进入到控制器，模型层，数据库，变成一个有用的数据返回出来，再通过lamp返回给浏览器，上面的流程就很容易发现，简单的像apache,nginx里面的配置文件定义，只是让外来请求找到这个入口文件，进入到入口文件里面之后就靠框架的路由寻找具体的控制器了。&lt;br&gt;lamp环境方便的让外来请求比如对于index.php的请求，如果是直接在linux中，我么需要php (编译器) 可能还需要 -c指定配置文件的位置 文件.php,这样。但是如果是lamp，我们可以通过浏览器直接访问这个php文件。&lt;br&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="lnmp" scheme="http://yoursite.com/tags/lnmp/"/>
    
      <category term="环境" scheme="http://yoursite.com/tags/%E7%8E%AF%E5%A2%83/"/>
    
  </entry>
  
  <entry>
    <title>php安装扩展</title>
    <link href="http://yoursite.com/2018/01/18/php%E5%AE%89%E8%A3%85%E6%89%A9%E5%B1%95/"/>
    <id>http://yoursite.com/2018/01/18/php安装扩展/</id>
    <published>2018-01-18T10:35:02.000Z</published>
    <updated>2018-02-23T12:47:39.741Z</updated>
    
    <content type="html"><![CDATA[<p>好久没有写文章了，今天来说一下关于php的扩展，虽然自己理解的不是很深，也没有仔细去研究，只是把平时工作中遇到的情况，解决途径写下来，还有很多不足的地方，以后去补充<br><a id="more"></a></p><p>php的扩展大部分都是c编写的，php -m 可以列出我们php中安装的扩展<br><img src="http://upload-images.jianshu.io/upload_images/5525740-a0582293f271520d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image"></p><p>其中swoole就是现在很火的php扩展。以这个为例子<br>Linux下安装</p><ol><li>获取tar.gz压缩包（可以去github上直接下载，或者去pecl（php 扩展库里面搜索））。</li><li>解压缩  tar xvf </li><li>进入解压缩目录（如果进入解压缩目录内部文件是so结尾的，不是.c 之类的结尾的，不用进行后面的操作）</li><li>phpize  (这个命令在php的安装目录下，bin目录下，和php命令在一个目录下)</li><li>./configure 生成配置文件，之前安装swoole的时候需要指定php-config,这可不是php的配置文件，也是一个命令，和上面的php，phpize在同一个bin目录下，如果想看更多参数可以 –help,</li><li>make</li><li>make install (安装失败make clean，重新再来呗)<br>8.生成的so文件自动放到了/usr/local/php/lib/php/extensions/no-debug-zts-20160303，然后在php.ini 文件里面加上一句extension = swoole.so就可以了</li></ol><p>windows下安装</p><ol><li>大部分都是xampp的这种集成环境，首先去pecl上下载dll文件，··像swoole我是没找到windows下的扩展文件，需要根据php版本 vc版本 TS Windows版本（windows一般是x86 和64，操作系统位数） 来选择 扩展文件的版本</li><li>解压后，把dll文件放到php的扩展目录下ext下面，然后在php.ini里面加上zend_exten```= 这个扩展文件名。就可以了</li></ol><p>之前安装redis扩展的时候，···当时用的是xampp，··然后安装好了redis扩展，可是使用不了。坑爹啊，window下我都没安装redis，光安装redis扩展有什么用，····其实这个扩展知识为了让php能操作redis，像apache，在编译安装php7的时候，也要指定apache的apxs之类的位置。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;好久没有写文章了，今天来说一下关于php的扩展，虽然自己理解的不是很深，也没有仔细去研究，只是把平时工作中遇到的情况，解决途径写下来，还有很多不足的地方，以后去补充&lt;br&gt;
    
    </summary>
    
      <category term="PHP" scheme="http://yoursite.com/categories/PHP/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="PHP" scheme="http://yoursite.com/tags/PHP/"/>
    
      <category term="扩展" scheme="http://yoursite.com/tags/%E6%89%A9%E5%B1%95/"/>
    
  </entry>
  
  <entry>
    <title>Linux常见问题</title>
    <link href="http://yoursite.com/2018/01/09/Linux%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2018/01/09/Linux常见问题/</id>
    <published>2018-01-08T16:17:31.000Z</published>
    <updated>2018-03-23T07:33:28.703Z</updated>
    
    <content type="html"><![CDATA[<p>因为linux平时用的不是很频繁，所以经常会遇见一些问题，然后很容易忘记，然后还经常遇到，所以记录下来。</p><p>目录：</p><ol><li>yum源替换</li><li>修改密码</li><li>locate 查找文件</li><li>添加环境变量</li><li>~ 普通用户和root用户</li></ol><a id="more"></a><p>1.yum源的替换<br>我们每次安装centos的时候，如果不是打包安装，是从新安装的话，为了安装软件速度快点，我们通常会替换yum源，把国外的镜像替换成国内的yum源镜像。常用的有163，阿里云啊。<br>首先我们进入 /etc/yum.repos.d 文件夹下面，查看repo文件，把centos-base 这个yum源文件改名，作为备份文件（mv,剪贴，又能当做重命名来用，注意不是复制哦）。然后wget，国内的yum源地址，yum clean all 清除缓存，yum makecache 在本地生成源的软件信息，方便软件的查找。<br>总结：</p><ol><li>cd /etc/yum.repos.d  进入目录</li><li>mv centos-base.repo centos-base.repo.bak  备份文件</li><li>wget -nc <a href="http://mirrors.aliyun.com/repo/Centos-7.repo" target="_blank" rel="external">http://mirrors.aliyun.com/repo/Centos-7.repo</a>   下载原文</li><li>yum clean all  清除缓存</li><li>yum makecache  生成缓存</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">*   阿里yum源:[http://mirrors.aliyun.com/repo/](http://mirrors.aliyun.com/repo/)</div><div class="line">*   163(网易)yum源: [http://mirrors.163.com/.help/](http://mirrors.163.com/.help/)</div><div class="line">*   中科大的Linux安装镜像源：[http://centos.ustc.edu.cn/](http://centos.ustc.edu.cn/)</div><div class="line">*   搜狐的Linux安装镜像源：[http://mirrors.sohu.com/](http://mirrors.sohu.com/)</div><div class="line">*   北京首都在线科技：[http://mirrors.yun-idc.com/](http://mirrors.yun-idc.com/)</div></pre></td></tr></table></figure><p>2.修改密码<br>passwd 用户名 root用户，非root用户只能修改自己的密码哦，所以passwd后面不能加参数</p><p>3.locate查找文件</p><p>locate 命令的使用<br>之前一直使用find / -name 文件名，太慢了，使用locate吧。<br>首先yum install mlocate,然后updatedb ,就可以使用locate 文件名称。每次使用前locate 文件名称。</p><p>4.添加环境变量</p><p>lamp环境如果通过源码编译安装，安装的位置一般是/usr/local,命令一般在/usr/local/软件/bin/命令，每次使用起来这么一大串，是在麻烦，加入环境变量效果棒棒的</p><ol><li><p>echo $PAHT 查看环境变量</p></li><li><p>编辑/etc/environment文件，在里面更改PATH环境变量。</p><p>例如：向环境变量中添加 /home/YRS/Nim/bin</p><p>/usr/local/bin:/usr/local/sbin:/usr/bin:/usr/sbin:/bin:/sbin:/home/YRS/Nim/bin，保存后记得source /etc/environment 。重新启动后就不用source 。</p><p>​</p></li></ol><p>5.普通用户的 ~代表家目录，比如/home/vagrant,但是root用户的这个~代表根目录 /home</p><p>​     </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;因为linux平时用的不是很频繁，所以经常会遇见一些问题，然后很容易忘记，然后还经常遇到，所以记录下来。&lt;/p&gt;
&lt;p&gt;目录：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;yum源替换&lt;/li&gt;
&lt;li&gt;修改密码&lt;/li&gt;
&lt;li&gt;locate 查找文件&lt;/li&gt;
&lt;li&gt;添加环境变量&lt;/li&gt;
&lt;li&gt;~ 普通用户和root用户&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Linux" scheme="http://yoursite.com/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://yoursite.com/tags/Linux/"/>
    
      <category term="常见问题" scheme="http://yoursite.com/tags/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
    
  </entry>
  
</feed>
